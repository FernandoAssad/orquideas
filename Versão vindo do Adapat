<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SAAS - Florescendo suas Orquídeas (V79.0 - Código Completo)</title>
    
    <!-- Bibliotecas Externas -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Inter:wght@300;400;600&family=Courier+New&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    
    <style>
        /* --- IDENTIDADE VISUAL --- */
        :root {
            --verde-principal: #2D5016;
            --verde-secundario: #4A7C3C;
            --verde-claro: #B8D4A8;
            --branco: #FFFFFF;
            --preto: #1A1A1A;
            --cinza: #5A5A5A;
            --destaque: #E8B71B;
            --excel: #217346;
            --money: #2ecc71;
            --alert-red: #e74c3c;
            --alert-blue: #3498db;
            --fundo-geral: #F5F9F4;
            --sombra: 0 4px 6px rgba(0,0,0,0.1);
            --sidebar-width: 280px;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; outline: none; -webkit-tap-highlight-color: transparent; }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--fundo-geral);
            color: var(--preto);
            display: flex;
            height: 100vh;
            overflow: hidden;
        }

        /* --- LOGOMARCA & ÍCONES --- */
        .logo-container {
            position: relative;
            text-align: center;
            margin-bottom: 20px;
            cursor: pointer;
        }
        
        .logo-img {
            max-width: 180px;
            height: auto;
            display: block;
            margin: 0 auto;
        }

        .logo-placeholder {
            font-size: 50px;
            color: var(--verde-principal);
            display: none;
            margin-bottom: 10px;
        }

        .btn-change-logo {
            font-size: 0.7rem;
            color: #666;
            text-decoration: underline;
            background: none;
            border: none;
            cursor: pointer;
            margin-top: 5px;
            display: block;
            width: 100%;
        }

        .sidebar-logo-img {
            max-width: 80%;
            margin: 0 auto 10px auto;
            display: block;
            background: rgba(255,255,255,0.9);
            padding: 5px;
            border-radius: 6px;
        }

        /* --- TELA DE LOGIN --- */
        #login-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--verde-principal);
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            z-index: 9999;
            transition: opacity 0.5s ease;
        }
        .login-box {
            background: white; padding: 40px; border-radius: 10px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
            width: 90%; max-width: 400px; text-align: center;
        }
        .login-box h2 { margin-bottom: 10px; color: var(--verde-principal); font-size: 1.3rem; }
        .login-box p { color: #666; margin-bottom: 30px; font-size: 0.9rem; }
        .login-input {
            width: 100%; padding: 15px; border: 2px solid #eee; border-radius: 8px;
            font-size: 1rem; margin-bottom: 20px; transition: 0.3s; text-align: center;
        }
        .login-input:focus { border-color: var(--destaque); }
        .btn-login {
            width: 100%; padding: 15px; background: var(--verde-principal); color: white;
            border: none; border-radius: 8px; font-size: 1rem; font-weight: bold; cursor: pointer;
            transition: 0.3s;
        }
        .btn-login:hover { background: var(--verde-secundario); }
        .login-error { color: red; margin-top: 15px; display: none; font-size: 0.9rem; font-weight: bold; }
        .loading-spinner { display: none; margin-left: 10px; }
        
        .btn-reset {
            background: #d32f2f; border: none; color: #fff; margin-top: 20px; 
            padding: 10px; border-radius: 5px; cursor: pointer; font-size: 0.8rem; width: 100%;
        }

        #app-wrapper { display: none; width: 100%; height: 100%; display: flex; } 

        /* --- TIPOGRAFIA --- */
        h1, h2, h3, h4 { font-family: 'Playfair Display', serif; color: var(--verde-principal); }
        
        /* --- LAYOUT & SIDEBAR --- */
        aside {
            width: var(--sidebar-width);
            background-color: var(--verde-principal);
            color: var(--branco);
            display: flex;
            flex-direction: column;
            box-shadow: 4px 0 10px rgba(0,0,0,0.1);
            z-index: 100;
            transition: transform 0.3s ease;
        }

        .logo-area {
            padding: 20px;
            text-align: center;
            background: rgba(0,0,0,0.1);
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        .logo-area h2 { font-size: 0.9rem; color: white; letter-spacing: 1px; margin-top: 5px; opacity: 0.9; }

        /* --- MENU --- */
        #main-nav { flex: 1; overflow-y: auto; padding-top: 10px; }
        .menu-item {
            padding: 15px 20px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.2s;
            border-left: 4px solid transparent;
            font-size: 0.95rem;
        }
        .menu-item:hover, .menu-item:active { background-color: var(--verde-secundario); border-left-color: var(--destaque); }
        .menu-item i.icon-left { width: 25px; text-align: center; margin-right: 10px; }
        
        .submenu { display: none; background-color: rgba(0,0,0,0.2); }
        .submenu.open { display: block; }
        .submenu-item {
            padding: 12px 20px 12px 55px;
            font-size: 0.9rem;
            cursor: pointer;
            color: #ddd;
            transition: 0.2s;
        }
        .submenu-item:hover { color: var(--destaque); background: rgba(255,255,255,0.05); }

        /* --- CONTEÚDO PRINCIPAL --- */
        main { flex: 1; display: flex; flex-direction: column; overflow: hidden; position: relative; width: 100%; }
        
        header {
            background: var(--branco);
            padding: 10px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            z-index: 50;
            height: 60px;
        }

        .menu-toggle { display: none; font-size: 1.5rem; color: var(--verde-principal); background: none; border: none; cursor: pointer; }

        .content-scroll { flex: 1; overflow-y: auto; padding: 20px; -webkit-overflow-scrolling: touch; }

        /* --- COMPONENTES UI --- */
        .card {
            background: var(--branco);
            border-radius: 8px;
            padding: 20px;
            box-shadow: var(--sombra);
            margin-bottom: 20px;
            width: 100%;
        }

        .btn {
            padding: 10px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: 0.2s;
            font-size: 0.9rem;
        }
        .btn:active { transform: scale(0.98); }
        .btn-primary { background: var(--verde-principal); color: white; }
        .btn-secondary { background: var(--verde-secundario); color: white; }
        .btn-accent { background: var(--destaque); color: var(--preto); }
        .btn-danger { background: #d32f2f; color: white; }
        .btn-ghost { background: #eee; color: #555; }
        .btn-edit { background: var(--destaque); color: var(--preto); }
        .btn-qr { background: #333; color: white; }
        .btn-excel { background: var(--excel); color: white; }
        .btn-sm { padding: 5px 10px; font-size: 0.8rem; }
        
        .btn-alert-on { background: var(--destaque); color: var(--preto); }
        .btn-alert-off { background: #ccc; color: #666; }

        .alert-icon { margin-right: 5px; font-size: 1.1rem; }
        .alert-repot { color: var(--alert-red); }
        .alert-flower { color: var(--destaque); }
        .alert-food { color: var(--alert-blue); }

        /* --- VISUALIZAÇÃO DE REGISTRO --- */
        .record-view {
            background: #fff;
            border-radius: 8px;
            padding: 20px;
            box-shadow: var(--sombra);
        }
        .record-field {
            margin-bottom: 15px;
            border-bottom: 1px solid #eee;
            padding-bottom: 5px;
        }
        .record-label {
            font-weight: bold;
            color: var(--verde-principal);
            display: block;
            font-size: 0.85rem;
            margin-bottom: 3px;
        }
        .record-value {
            color: var(--cinza);
            font-size: 1rem;
            word-wrap: break-word;
        }
        .record-image-container {
            margin-top: 25px;
            text-align: center;
            border: 2px solid #eee;
            padding: 15px;
            border-radius: 8px;
            background: #fafafa;
        }
        .record-image-label {
            display: block;
            font-weight: bold;
            color: var(--verde-principal);
            margin-bottom: 10px;
            text-align: left;
        }
        .record-image {
            max-width: 100%;
            max-height: 400px;
            border-radius: 4px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        /* --- BARRA DE CONTROLE (BOTOEIRA) --- */
        .control-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #f1f1f1;
            padding: 10px;
            border-radius: 8px;
            margin-top: 20px;
            flex-wrap: wrap;
            gap: 10px;
        }
        .nav-group, .action-group {
            display: flex;
            gap: 5px;
        }
        .btn-nav {
            background: var(--verde-principal);
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            border: none;
            cursor: pointer;
            font-size: 1rem;
        }
        .btn-nav:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        /* --- ESTILOS DE RELATÓRIO --- */
        .report-card {
            background: #fff;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            page-break-inside: avoid;
        }
        .report-card-row {
            display: flex;
            border-bottom: 1px solid #eee;
            padding: 5px 0;
        }
        .report-card-label {
            font-weight: bold;
            width: 40%;
            color: var(--verde-principal);
            font-size: 0.9rem;
        }
        .report-card-value {
            width: 60%;
            color: #333;
            font-size: 0.9rem;
        }
        .report-card-image {
            margin-top: 10px;
            text-align: center;
        }
        .report-card-image img {
            max-width: 150px;
            max-height: 150px;
            border-radius: 4px;
            border: 1px solid #ddd;
        }

        /* --- TABELAS RESPONSIVAS --- */
        .table-container { 
            overflow-x: auto; 
            border-radius: 8px; 
            border: 1px solid #eee; 
            margin-top: 15px;
            -webkit-overflow-scrolling: touch;
        }
        table { width: 100%; border-collapse: collapse; min-width: 600px; }
        th { background: var(--verde-claro); color: var(--verde-principal); padding: 12px 15px; text-align: left; font-weight: bold; white-space: nowrap; }
        td { padding: 12px 15px; border-bottom: 1px solid #eee; color: var(--cinza); vertical-align: middle; }
        tr:hover { background: #f9f9f9; }
        
        .thumb-img { width: 50px; height: 50px; object-fit: cover; border-radius: 4px; border: 1px solid #ddd; }

        /* --- MODAL RESPONSIVO --- */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.6);
            display: none; justify-content: center; align-items: center;
            z-index: 1000; backdrop-filter: blur(2px);
            padding: 10px;
        }
        .modal-box {
            background: white; width: 100%; max-width: 800px; max-height: 95vh;
            border-radius: 10px; display: flex; flex-direction: column;
            box-shadow: 0 20px 50px rgba(0,0,0,0.3);
        }
        .modal-header {
            padding: 15px 20px; border-bottom: 1px solid #eee;
            display: flex; justify-content: space-between; align-items: center;
            background: var(--verde-principal); color: white;
            border-radius: 10px 10px 0 0;
        }
        .modal-body { padding: 20px; overflow-y: auto; }
        .modal-footer {
            padding: 15px 20px; border-top: 1px solid #eee;
            display: flex; flex-wrap: wrap; justify-content: flex-end; gap: 10px;
            background: #f9f9f9; border-radius: 0 0 10px 10px;
        }
        .modal-footer .btn { flex: 1 1 auto; min-width: 120px; }

        /* --- FORMULÁRIOS --- */
        .form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; }
        .form-group label { display: block; margin-bottom: 6px; color: var(--cinza); font-weight: 600; font-size: 0.9rem; }
        .form-control {
            width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 6px;
            font-family: 'Inter', sans-serif; font-size: 1rem;
        }
        .form-control:focus { border-color: var(--verde-secundario); box-shadow: 0 0 0 3px rgba(74, 124, 60, 0.1); }
        .readonly-field { background-color: #e9ecef; color: #495057; }

        .drop-zone {
            border: 2px dashed #ccc; border-radius: 8px; padding: 20px;
            text-align: center; cursor: pointer; background: #fafafa;
            min-height: 120px; display: flex; flex-direction: column; justify-content: center; align-items: center;
        }
        .preview-img { max-width: 100%; max-height: 200px; margin-top: 10px; border-radius: 4px; display: none; }
        .preview-active .default-content { display: none; }
        .preview-active .preview-img { display: block; }

        /* --- DASHBOARD & RELATÓRIOS --- */
        .dash-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 20px; }
        .kpi-card {
            background: white; padding: 20px; border-radius: 8px;
            border-left: 5px solid var(--verde-principal);
            box-shadow: var(--sombra);
        }
        .kpi-card h4 { color: var(--cinza); font-size: 0.9rem; margin-bottom: 5px; font-family: 'Inter', sans-serif; }
        .kpi-card .value { font-size: 2rem; font-weight: bold; color: var(--verde-principal); }
        
        .kpi-money .value { color: var(--money); }
        .kpi-money { border-left-color: var(--money); }

        .charts-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-top: 20px; }
        .chart-container { position: relative; height: 300px; width: 100%; }

        /* AGENDA NO DASHBOARD */
        .agenda-list { list-style: none; padding: 0; margin: 0; }
        .agenda-item {
            display: flex; justify-content: space-between; align-items: center;
            padding: 12px 0; border-bottom: 1px solid #eee;
        }
        .agenda-item:last-child { border-bottom: none; }
        .agenda-date { font-weight: bold; color: var(--verde-principal); font-size: 1.1rem; }
        .agenda-info { font-size: 0.9rem; color: var(--cinza); }
        
        .tag-repot { background: #fff3cd; color: #856404; padding: 4px 8px; border-radius: 4px; font-size: 0.75rem; font-weight: bold; }
        .tag-adubo { background: #d1e7dd; color: #0f5132; padding: 4px 8px; border-radius: 4px; font-size: 0.75rem; font-weight: bold; }
        .tag-defensivo { background: #f8d7da; color: #842029; padding: 4px 8px; border-radius: 4px; font-size: 0.75rem; font-weight: bold; }

        .report-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; }
        .report-btn-list button { width: 100%; text-align: left; margin-bottom: 5px; }

        /* --- QR CODE MODAL --- */
        #qr-display { display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 20px; }
        #qrcode { margin-bottom: 20px; border: 10px solid white; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
        .qr-info { text-align: center; margin-bottom: 20px; }
        .qr-info h4 { margin: 0; color: var(--verde-principal); }
        .qr-info p { margin: 5px 0; color: var(--cinza); }

        /* --- TOAST --- */
        #toast {
            position: fixed; bottom: 20px; right: 20px; left: 20px;
            background: var(--verde-principal); color: white;
            padding: 15px; border-radius: 8px; text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            transform: translateY(150px); transition: 0.3s; z-index: 2000;
        }
        #toast.show { transform: translateY(0); }

        /* --- MOBILE OVERLAY --- */
        .sidebar-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5); z-index: 90; display: none;
        }

        /* --- MEDIA QUERIES --- */
        @media (max-width: 768px) {
            aside { position: fixed; top: 0; left: 0; height: 100%; transform: translateX(-100%); }
            aside.active { transform: translateX(0); }
            .sidebar-overlay.active { display: block; }
            .menu-toggle { display: block; }
            .form-grid { grid-template-columns: 1fr; }
            .toolbar { flex-direction: column; gap: 10px; }
            .toolbar div, .toolbar button { width: 100%; }
            #toast { bottom: 10px; left: 10px; right: 10px; }
            .modal-footer { justify-content: center; }
            .control-bar { justify-content: center; }
        }

        /* --- IMPRESSÃO (V79.0 - CORREÇÃO ABSOLUTA) --- */
        @media print {
            /* 1. Oculta TUDO na página */
            body * {
                visibility: hidden;
            }

            /* 2. Torna visível APENAS o relatório e seus filhos */
            #report-result, #report-result * {
                visibility: visible;
            }

            /* 3. Posiciona o relatório no topo absoluto da página */
            #report-result {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                margin: 0;
                padding: 0;
                background: white;
            }

            /* 4. Configurações de Página */
            @page {
                size: auto;
                margin: 1.5cm;
            }

            /* 5. Ajustes de Quebra de Página */
            .report-card {
                page-break-inside: avoid;
                break-inside: avoid;
                border: 1px solid #000;
                margin-bottom: 15px;
            }
            
            table {
                width: 100% !important;
                border-collapse: collapse;
            }
            
            th, td {
                border: 1px solid #000 !important;
                color: black !important;
            }
        }
    </style>
</head>
<body>

    <!-- TELA DE LOGIN -->
    <div id="login-screen">
        <div class="login-box">
            <!-- SISTEMA DE LOGO COM UPLOAD -->
            <div class="logo-container" onclick="document.getElementById('logo-upload').click()">
                <img src="data:image/png;base64,[data:image/png;base64,iVBORw0KGgo...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]" id="login-logo-img" class="logo-img" alt="SAAS Orquídeas" onerror="this.style.display='none'; document.getElementById('login-icon-fallback').style.display='block';">
                <i id="login-icon-fallback" class="fas fa-spa logo-placeholder"></i>
                <button class="btn-change-logo">Definir Logomarca</button>
            </div>
            <input type="file" id="logo-upload" hidden accept="image/*" onchange="App.changeLogo(this)">
            
            <h2>SAAS - Florescendo suas Orquídeas</h2>
            <p>Digite sua chave de acesso para continuar.</p>
            
            <input type="text" id="license-key" class="login-input" placeholder="Digite a Sua Senha">
            <button class="btn-login" onclick="Auth.validate()">
                <i class="fas fa-lock"></i> ACESSAR SISTEMA <i class="fas fa-spinner fa-spin loading-spinner"></i>
            </button>
            <div id="login-error" class="login-error">Chave inválida ou licença inativa.</div>
            
            <!-- BOTÃO DE EMERGÊNCIA -->
            <button class="btn-reset" onclick="if(confirm('ATENÇÃO: Isso apagará TODOS os dados e reiniciará o sistema como novo. Continuar?')) { localStorage.clear(); location.reload(); }">
                <i class="fas fa-trash-restore"></i> Resetar Sistema (Emergência)
            </button>
        </div>
    </div>

    <!-- APLICAÇÃO (INICIALMENTE OCULTA) -->
    <div id="app-wrapper" style="display:none;">
        <!-- MOBILE OVERLAY -->
        <div class="sidebar-overlay" onclick="UI.toggleSidebar()"></div>

        <!-- SIDEBAR -->
        <aside id="sidebar">
            <div class="logo-area">
                <!-- LOGOMARCA DA SIDEBAR -->
		<img src="data:image/png;base64,iVBORw0KGgo...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]" alt="Logo Florescendo" style="height: 40px; margin-right: 15px;">
                <i id="sidebar-icon-fallback" class="fas fa-spa" style="font-size: 40px; color: var(--destaque); margin-bottom: 10px; display: none;"></i>
                
                <h2>SAAS - Florescendo suas Orquídeas</h2>
            </div>
            <nav id="main-nav"></nav>
        </aside>

        <!-- MAIN CONTENT -->
        <main>
            <header>
                <div style="display:flex; align-items:center; gap:15px;">
                    <button class="menu-toggle" onclick="UI.toggleSidebar()">
                        <i class="fas fa-bars"></i>
                    </button>
                    <h2 id="header-title" style="font-size:1.2rem; margin:0;">Dashboard</h2>
                </div>
                <div style="display: flex; align-items: center; gap: 10px;">
                    <span id="user-name-display" style="font-size: 0.8rem; color: var(--cinza); display:none; sm:display:block;">Usuário</span>
                    <i class="fas fa-user-circle fa-lg" style="color:var(--verde-principal)"></i>
                    <button onclick="Auth.logout()" title="Sair" style="background:none; border:none; color:var(--alert-red); cursor:pointer; margin-left:5px;">
                        <i class="fas fa-sign-out-alt"></i>
                    </button>
                </div>
            </header>

            <div class="content-scroll" id="app-content">
                <!-- O conteúdo será injetado aqui via JavaScript -->
            </div>
        </main>
    </div>

    <!-- MODAL DE CADASTRO -->
    <div class="modal-overlay" id="modal-cadastro">
        <div class="modal-box">
            <div class="modal-header">
                <h3 id="modal-title">Novo Registro</h3>
                <button onclick="UI.closeModal()" style="background:none; border:none; color:white; cursor:pointer;">
                    <i class="fas fa-times fa-lg"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-grid" id="modal-fields"></div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-ghost" onclick="UI.closeModal()">Cancelar</button>
                <button class="btn btn-secondary" id="btn-save-new" onclick="App.save(true)">
                    <i class="fas fa-plus-circle"></i> Salvar + Novo
                </button>
                <button class="btn btn-primary" id="btn-save-close" onclick="App.save(false)">
                    <i class="fas fa-check"></i> Salvar
                </button>
            </div>
        </div>
    </div>

    <!-- MODAL QR CODE -->
    <div class="modal-overlay" id="modal-qr-code">
        <div class="modal-box" style="max-width: 400px;">
            <div class="modal-header">
                <h3>Etiqueta QR Code</h3>
                <button onclick="document.getElementById('modal-qr-code').style.display='none'" style="background:none; border:none; color:white; cursor:pointer;">
                    <i class="fas fa-times fa-lg"></i>
                </button>
            </div>
            <div class="modal-body" id="qr-display">
                <div class="qr-info">
                    <h4 id="qr-title">Orquídea #123</h4>
                    <p id="qr-subtitle">Cattleya Walkeriana</p>
                </div>
                <div id="qrcode"></div>
            </div>
            <div class="modal-footer" style="justify-content: center;">
                <button class="btn btn-primary" onclick="window.print()">
                    <i class="fas fa-print"></i> Imprimir
                </button>
            </div>
        </div>
    </div>

    <!-- TOAST NOTIFICATION -->
    <div id="toast"><i class="fas fa-check-circle"></i> <span id="toast-msg">Sucesso!</span></div>

    <!-- LÓGICA DO SISTEMA -->
    <script>
        // --- MONITOR DE ERROS ---
        window.onerror = function(message, source, lineno, colno, error) {
            console.error("Erro Crítico:", message);
        };

        // --- CONFIGURAÇÃO DE SEGURANÇA (COM PROXY) ---
        const GOOGLE_SHEET_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vT0o846QVc_zpsF9_XFvt1RyoghNH5vLaQZuuYrosNEOiQQkaKgWI6arDdz09vcFP0YsaFLaW5kkmhZ/pub?gid=0&single=true&output=csv";
        const PROXY_URL = "https://api.allorigins.win/raw?url=";
        const URL_PLANILHA = PROXY_URL + encodeURIComponent(GOOGLE_SHEET_URL);
        
        const CONFIG = { email: 'fernandoemassad@gmail.com' };

        // ==================================================================
        // 1. DEFINIÇÃO DE DADOS (CONSTANTES) - MOVIDO PARA O TOPO
        // ==================================================================

        // --- SCHEMAS ---
        const SCHEMAS = {
                generos: {
        label: "Gêneros",
        icon: "fa-dna",
        fields: [
            { key: "nome", label: "Nome do Gênero", type: "text", required: true }
        ]
    },
                especies: {
        label: "Espécies",
        icon: "fa-seedling",
        fields: [
            { key: "nome", label: "Nome da Espécie", type: "text", required: true },
            { key: "genero", label: "Gênero Relacionado", type: "select", source: "generos" }
        ]
    },
            'variacao': { label: 'Variação Cromática', fields: [
                { key: 'codigo', label: 'Código', type: 'readonly' },
                { key: 'variacao', label: 'Variação', type: 'text' }
            ]},
                habitats: {
        label: "Habitats Principais",
        icon: "fas fa-mountain-sun",
        fields: [
            { key: "codigo", label: "Código", type: "text", readonly: true },
            { key: "habitat", label: "Nome do Habitat/Bioma", type: "text", required: true },
            'origem': { label: 'Procedência Geográfica', fields: [
                { key: 'codigo', label: 'Código', type: 'readonly' },
                { key: 'local', label: 'Local de Origem', type: 'text' }
            ]},
            'locais_compra': { label: 'Onde foi comprada', fields: [
                { key: 'codigo', label: 'Código', type: 'readonly' },
                { key: 'tipo_local', label: 'Local', type: 'text' },
                { key: 'nome', label: 'Nome do Estabelecimento', type: 'text' },
                { key: 'municipio_uf', label: 'Município e Estado', type: 'text' },
                { key: 'telefone', label: 'Telefone de contato', type: 'text' },
                { key: 'site', label: 'Site', type: 'text' }
            ]},
            'ambientes': { label: 'Ambientes', fields: [
                { key: 'codigo', label: 'Código', type: 'readonly' },
                { key: 'local', label: 'Nome do Local', type: 'text' },
                { key: 'tipo', label: 'Tipo', type: 'select', options: ['Estufa', 'Ar Livre', 'Interior', 'Sombrite'] },
                { key: 'area', label: 'Área (m²)', type: 'number' },
                { key: 'orientacao', label: 'Orientação Solar', type: 'select', options: ['Norte', 'Sul', 'Leste', 'Oeste', 'Não definida'] }
            ]},
            'vasos': { label: 'Vasos', fields: [
                { key: 'codigo', label: 'Código', type: 'readonly' },
                { key: 'tipo', label: 'Tipo', type: 'text' },
                { key: 'material', label: 'Material', type: 'text' },
                { key: 'tamanho', label: 'Tamanho', type: 'text' },
                { key: 'preco', label: 'Preço', type: 'money' },
            ]},
            'substratos': { label: 'Substratos', fields: [
                { key: 'codigo', label: 'Código', type: 'readonly' },
                { key: 'tipo', label: 'Tipo', type: 'text' },
                { key: 'retencao', label: 'Retenção Água', type: 'select', options: ['Alta', 'Média', 'Baixa'] },
                { key: 'drenagem', label: 'Drenagem', type: 'select', options: ['Alta', 'Média', 'Baixa'] },
                { key: 'preco', label: 'Preço', type: 'money' },
                { key: 'foto', label: 'Foto do Substrato', type: 'image' }
            ]},
            'adubos': { label: 'Adubos', fields: [
                { key: 'codigo', label: 'Código', type: 'readonly' },
                { key: 'produto', label: 'Produto', type: 'text' },
                { key: 'tipo', label: 'Tipo', type: 'text' },
                { key: 'aplicacao', label: 'Aplicação', type: 'select', options: ['Foliar', 'Substrato', 'Fertirrigação'] },
                { key: 'preco', label: 'Preço', type: 'money' }
            ]},
            'defensivos': { label: 'Defensivos', fields: [
                { key: 'codigo', label: 'Código', type: 'readonly' },
                { key: 'nome', label: 'Nome', type: 'text' },
                { key: 'classe', label: 'Toxicidade', type: 'select', options: ['Classe 1', 'Classe 2', 'Classe 3', 'Classe 4', 'Classe 5', 'Sem toxidade'] },
                { key: 'epi', label: 'Exige EPI?', type: 'select', options: ['Sim', 'Não'] },
                { key: 'preco', label: 'Preço', type: 'money' }
            ]},
            'pragas': { label: 'Pragas', fields: [
                { key: 'codigo', label: 'Código', type: 'readonly' },
                { key: 'nome', label: 'Nome', type: 'text' },
                { key: 'nome_cientifico', label: 'Nome Científico', type: 'text' },
                { key: 'apelidos', label: 'Apelidos', type: 'text' },
                { key: 'tipo', label: 'Tipo', type: 'text' },
                { key: 'habito', label: 'Hábito Alimentar', type: 'text' },
                { key: 'cor', label: 'Cor Predominante', type: 'text' },
                { key: 'ciclo_vida', label: 'Ciclo de Vida', type: 'text' },
                { key: 'duracao_vida', label: 'Duração de Vida', type: 'text' },
                { key: 'estagio_ovo', label: 'Estágio Ovo (Dias)', type: 'number' },
                { key: 'estagio_larva', label: 'Estágio Larva (Dias)', type: 'number' },
                { key: 'estagio_pupa', label: 'Estágio Pupa (Dias)', type: 'number' },
                { key: 'estagio_adulto', label: 'Estágio Adulto', type: 'text' },
                { key: 'reproducao', label: 'Tipo de Reprodução', type: 'text' },
                { key: 'obs', label: 'Observações', type: 'text' },
                { key: 'foto', label: 'Imagens', type: 'image' }
            ]},
            'doencas': { label: 'Doenças', fields: [
                { key: 'codigo', label: 'Código', type: 'readonly' },
                { key: 'nome', label: 'Nome', type: 'text' },
                { key: 'nome_cientifico', label: 'Nome Científico', type: 'text' },
                { key: 'apelido', label: 'Apelido', type: 'text' },
                { key: 'patogeno', label: 'Patógeno', type: 'text' },
                { key: 'principio_ativo', label: 'Princípio Ativo Eficiente', type: 'text' },
                { key: 'estrutura', label: 'Estrutura Reprodutiva', type: 'text' },
                { key: 'hospeda_substrato', label: 'Substrato pode hospedar?', type: 'select', options: ['Sim', 'Não'] },
                { key: 'hospeda_agua', label: 'Água pode hospedar?', type: 'select', options: ['Sim', 'Não'] },
                { key: 'nivel_comprometimento', label: 'Nível de Comprometimento (0-10)', type: 'number' },
                { key: 'velocidade', label: 'Velocidade de Evolução', type: 'text' },
                { key: 'risco_perda', label: 'Risco de Perda Total?', type: 'select', options: ['Sim', 'Não'] },
                { key: 'recuperacao', label: 'Recuperação Possível?', type: 'select', options: ['Sim', 'Não'] },
                { key: 'foto', label: 'Imagem', type: 'image' }
            ]},
            'disturbios': { label: 'Distúrbios Fisiológicos', fields: [
                { key: 'codigo', label: 'Código', type: 'readonly' },
                { key: 'nome', label: 'Nome do Distúrbio', type: 'text' },
                { key: 'tipo', label: 'Tipo', type: 'select', options: ['Nutricional', 'Fisiológico', 'Climático'] },
                { key: 'nutriente', label: 'Nutriente/Fator Envolvido', type: 'text' },
                { key: 'partes_afetadas', label: 'Partes Afetadas', type: 'text' },
                { key: 'sinais', label: 'Sinais Principais', type: 'text' },
                { key: 'causa', label: 'Causa Raiz', type: 'text' },
                { key: 'condicoes', label: 'Condições Favoráveis', type: 'text' },
                { key: 'reversibilidade', label: 'Reversibilidade', type: 'select', options: ['Sim', 'Não', 'Parcial'] },
                { key: 'tempo', label: 'Tempo de Manifestação', type: 'text' },
                { key: 'severidade', label: 'Severidade', type: 'select', options: ['Baixa', 'Média', 'Alta', 'Muito Alta'] },
                { key: 'prejuizos', label: 'Prejuízos Causados', type: 'text' },
                { key: 'manejo', label: 'Manejo Preventivo', type: 'text' },
                { key: 'tratamento', label: 'Tratamento', type: 'text' },
                { key: 'periodo', label: 'Período Crítico', type: 'text' },
                { key: 'fotos', label: 'Imagens de Referência', type: 'image' }
            ]},
            'motivos_replantio': { label: 'Motivos de Replantio', fields: [
                { key: 'codigo', label: 'Código', type: 'readonly' },
                { key: 'motivo', label: 'Motivo', type: 'text' }
            ]},
		 // --- NOVO BLOCO: FORMAS DE VIDA ---
    	'formas_vida': {
        label: "Formas de Vida",
        icon: "fa-leaf",
        fields: [
            { key: "codigo", label: "Código", type: "text", readonly: true },
            { key: "nome", label: "Tipo", type: "text" },
            { key: "descricao", label: "Dicas e Características", type: "textarea" }
        ]
    },
		// NOVO BLOCO: ADICIONE AQUI
	    'habitats': {
        	label: "Habitats Principais", icon: "fas fa-mountain-sun",fields: [
            { key: "codigo", label: "Código", type: "text", readonly: true },
            { name: "habitat", label: "Nome do Habitat/Bioma", type: "text", required: true },
            { name: "regiao", label: "Região Principal", type: "text" },
            { name: "descricao", label: "Características e Condições", type: "textarea" },
            { name: "exemplos", label: "Exemplos de Orquídeas", type: "textarea" }
        ]},

    'orquideas': { // ... seu schema existente de orquideas. ADICIONE esta linha dentro do array fields:
        // ... campos existentes ...
        { name: "habitat", label: "Habitat Natural", type: "select", source: "habitats" }, // &lt;--- NOVA LINHA: Vincula ao campo habitat
        // ... resto dos campos ...
    },
    'orquideas': {
        label: "Minhas Orquídeas", icon: "fa-leaf", fields: [
                { key: "id", label: "ID", type: "text", readonly: true },
                { key: "nome", label: "Nome / Híbrido", type: "text", required: true },
                { key: "especie", label: "Espécie", type: "select", source: "especies" },
                { key: "genero", label: "Gênero", type: "select", source: "generos" },
                { key: "cor", label: "Cor Predominante", type: "color" },
                { key: "forma_vida", label: "Forma de Vida", type: "select", source: "formas_vida" },
                { key: "habitat", label: "Habitat Natural", type: "select", source: "habitats" },
                { key: "data_aquisicao", label: "Data Aquisição", type: "date" },
                { key: "foto", label: "Foto da Planta", type: "file" },
                { key: "procedencia", label: "Procedência Geográfica", type: "select", source: "origem" },
                { key: "floracao", label: "Época de Floração", type: "text" },
                { key: "vaso", label: "Vaso", type: "select", source: "vasos" },
                { key: "substrato", label: "Substrato", type: "select", source: "substratos" },
                { key: "data_replantio", label: "Data Replantio", type: "date" },
                 { key: "prox_replantio", label: "Próximo Replantio", type: "date" }
            ]},            
            'replantios': { label: 'Histórico Replantios', fields: [
                { key: 'codigo', label: 'Código', type: 'readonly' },
                { key: 'orquidea', label: 'Orquídea', type: 'lookup', source: 'orquideas' },
                { key: 'data', label: 'Data', type: 'date' },
                { key: 'motivo', label: 'Motivo', type: 'lookup', source: 'motivos_replantio' },
                { key: 'prox_data', label: 'Próximo Replantio', type: 'date' }
            ]},
            'nutricao': { label: 'Nutrição', fields: [
                { key: 'codigo', label: 'Código', type: 'readonly' },
                { key: 'data', label: 'Data', type: 'date' },
                { key: 'adubo', label: 'Adubo', type: 'lookup', source: 'adubos' },
                { key: 'dosagem', label: 'Dosagem', type: 'text' }
            ]},
            'aplicacao_defensivos': { label: 'Aplicação de Defensivos', fields: [
                { key: 'codigo', label: 'Código', type: 'readonly' },
                { key: 'data', label: 'Data da Aplicação', type: 'date' },
                { key: 'defensivo', label: 'O que foi aplicado', type: 'lookup', source: 'defensivos' },
                { key: 'dosagem', label: 'Dosagem Aplicada', type: 'text' },
                { key: 'motivo', label: 'Motivo da Aplicação', type: 'text' }
            ]},
            'agendamentos': { label: 'Agenda de Aplicações', fields: [
                { key: 'codigo', label: 'Código', type: 'readonly' },
                { key: 'tipo', label: 'Tipo', type: 'select', options: ['Adubação', 'Defensivos'] },
                { key: 'data', label: 'Data Programada', type: 'date' },
                { key: 'detalhes', label: 'Produto / Detalhes', type: 'select', options: [] }, // VAZIO INICIALMENTE
                { key: 'status', label: 'Status', type: 'select', options: ['Pendente', 'Concluído'] }
            ]},
            'lembretes': { label: 'Lembretes Automáticos', fields: [
                { key: 'codigo', label: 'Código', type: 'readonly' },
                { key: 'orquideaId', label: 'Orquídea', type: 'lookup', source: 'orquideas' },
                { key: 'tipo', label: 'Tipo de Lembrete', type: 'select', options: ['Rega', 'Adubação', 'Replantio', 'Pulverização', 'Inspeção', 'Outro'] },
                { key: 'frequencia', label: 'Frequência', type: 'select', options: ['Diária', 'Semanal', 'Quinzenal', 'Mensal', 'Trimestral', 'Semestral'] },
                { key: 'data_inicio', label: 'Data de Início', type: 'date' },
                { key: 'proxima_data', label: 'Próxima Data (Calculada)', type: 'date' },
                { key: 'ativo', label: 'Ativo?', type: 'select', options: ['Sim', 'Não'] },
                { key: 'descricao', label: 'Descrição/Notas', type: 'text' },
                { key: 'ultima_execucao', label: 'Última Execução', type: 'date' }
            ]},

            'execucoes_lembretes': { label: 'Histórico de Execuções de Lembretes', fields: [
                { key: 'codigo', label: 'Código', type: 'readonly' },
                { key: 'lembreteId', label: 'ID do Lembrete', type: 'text' },
                { key: 'orquideaId', label: 'Orquídea', type: 'lookup', source: 'orquideas' },
                { key: 'tipo', label: 'Tipo', type: 'text' },
                { key: 'data_execucao', label: 'Data de Execução', type: 'date' },
                { key: 'status', label: 'Status', type: 'select', options: ['Concluído', 'Atrasado', 'Ignorado'] },
                { key: 'notas', label: 'Notas de Execução', type: 'text' }
            ]},
        };

        // --- DADOS INICIAIS (SEED DATA - HIGIENIZADO) ---
        const INITIAL_DATA = {
            pragas: [
                { codigo: 1, nome: `Cochonilha branca`, nome_cientifico: `Planococcus citri`, apelidos: `Piolho-farinhento`, tipo: `Insecto`, habito: `Sugador de seiva`, cor: `Branco`, ciclo_vida: `Metamorfose incompleta`, duracao_vida: `45 dias`, estagio_ovo: 7, estagio_larva: 22, estagio_pupa: 0, estagio_adulto: `16 dias`, reproducao: `Sexuada/Partenogênese`, foto: 'Cochonilha-Branca2.jpg' },
                { codigo: 2, nome: `Cochonilha de carapaça`, nome_cientifico: `Diaspididae spp.`, apelidos: `Cochonilha-escama`, tipo: `Insecto`, habito: `Sugador de seiva`, cor: `Marrom`, ciclo_vida: `Metamorfose incompleta`, duracao_vida: `75 dias`, estagio_ovo: 10, estagio_larva: 40, estagio_pupa: 0, estagio_adulto: `25 dias`, reproducao: `Sexuada/Partenogênese` },
                { codigo: 3, nome: `Ácaro rajado`, nome_cientifico: `Tetranychus urticae`, apelidos: `Ácaro-aranha`, tipo: `Ácaro`, habito: `Sugador de seiva`, cor: `Verde-amarelado`, ciclo_vida: `Direto`, duracao_vida: `20 dias`, estagio_ovo: 5, estagio_larva: 3, estagio_pupa: 0, estagio_adulto: `12 dias`, reproducao: `Sexuada/Partenogênese` },
                { codigo: 4, nome: `Trips`, nome_cientifico: `Frankliniella occidentalis`, apelidos: `Lagarta-minadora`, tipo: `Insecto`, habito: `Raspador-sugador`, cor: `Amarelo/Marrom/Preto`, ciclo_vida: `Metamorfose intermediária`, duracao_vida: `22 dias`, estagio_ovo: 5, estagio_larva: 7, estagio_pupa: 5, estagio_adulto: `5 dias`, reproducao: `Sexuada/Partenogênese` },
                { codigo: 5, nome: `Pulgão amarelo`, nome_cientifico: `Aphis spiraecola`, apelidos: `Piolho-das-plantas`, tipo: `Insecto`, habito: `Sugador de seiva`, cor: `Amarelo/Verde-claro`, ciclo_vida: `Metamorfose incompleta`, duracao_vida: `15 dias`, estagio_ovo: 0, estagio_larva: 7, estagio_pupa: 0, estagio_adulto: `8 dias`, reproducao: `Partenogênese (principalmente)` },
                { codigo: 6, nome: `Pulgão preto`, nome_cientifico: `Aphis fabae`, apelidos: `Piolho-preto`, tipo: `Insecto`, habito: `Sugador de seiva`, cor: `Preto/Marrom escuro`, ciclo_vida: `Metamorfose incompleta`, duracao_vida: `15 dias`, estagio_ovo: 0, estagio_larva: 7, estagio_pupa: 0, estagio_adulto: `8 dias`, reproducao: `Partenogênese (principalmente)` },
                { codigo: 7, nome: `Mosca branca`, nome_cientifico: `Bemisia tabaci`, apelidos: `Mosquinha-branca`, tipo: `Insecto`, habito: `Sugador de seiva`, cor: `Branco`, ciclo_vida: `Metamorfose incompleta`, duracao_vida: `30 dias`, estagio_ovo: 7, estagio_larva: 15, estagio_pupa: 7, estagio_adulto: `11 dias`, reproducao: `Sexuada/Partenogênese` },
                { codigo: 8, nome: `Ácaro vermelho`, nome_cientifico: `Tetranychus cinnabarinus`, apelidos: `Ácaro-vermelho-do-chá`, tipo: `Ácaro`, habito: `Sugador de seiva`, cor: `Vermelho`, ciclo_vida: `Direto`, duracao_vida: `20 dias`, estagio_ovo: 5, estagio_larva: 3, estagio_pupa: 0, estagio_adulto: `12 dias`, reproducao: `Sexuada/Partenogênese` },
                { codigo: 9, nome: `Tenthecoris bicolor (percevejo)`, nome_cientifico: `Tenthecoris bicolor`, apelidos: `Percevejo-das-orquídeas`, tipo: `Insecto`, habito: `Sugador de seiva`, cor: `Laranja e Preto`, ciclo_vida: `Metamorfose incompleta`, duracao_vida: `45 dias`, estagio_ovo: 10, estagio_larva: 22, estagio_pupa: 0, estagio_adulto: `13 dias`, reproducao: `Sexuada` },
                { codigo: 10, nome: `Lesma`, nome_cientifico: `Arion lusitanicus`, apelidos: `Limax`, tipo: `Molusco`, habito: `Mastigador`, cor: `Cinza/Marrom`, ciclo_vida: `Direto`, duracao_vida: `270 dias`, estagio_ovo: 30, estagio_larva: 0, estagio_pupa: 0, estagio_adulto: `240 dias`, reproducao: `Hermafrodita` },
                { codigo: 11, nome: `Caracol`, nome_cientifico: `Helix aspersa`, apelidos: `Caracol-de-jardim`, tipo: `Molusco`, habito: `Mastigador`, cor: `Marrom/Cinza (concha)`, ciclo_vida: `Direto`, duracao_vida: `540 dias`, estagio_ovo: 20, estagio_larva: 0, estagio_pupa: 0, estagio_adulto: `520 dias`, reproducao: `Hermafrodita` },
                { codigo: 12, nome: `Fungus gnats`, nome_cientifico: `Bradysia spp.`, apelidos: `Mosquito-do-fungo`, tipo: `Insecto`, habito: `Larvas: matéria orgânica e raízes`, cor: `Preto (adulto)`, ciclo_vida: `Metamorfose completa`, duracao_vida: `25 dias`, estagio_ovo: 4, estagio_larva: 12, estagio_pupa: 5, estagio_adulto: `4 dias`, reproducao: `Sexuada` },
                { codigo: 13, nome: `Tatuzinho`, nome_cientifico: `Porcellionides pruinosus`, apelidos: `Bicho-de-conta`, tipo: `Crustáceo`, habito: `Detritívoro`, cor: `Cinza/Marrom`, ciclo_vida: `Direto`, duracao_vida: `540 dias`, estagio_ovo: 0, estagio_larva: 90, estagio_pupa: 0, estagio_adulto: `450 dias`, reproducao: `Sexuada` }
            ],
            disturbios: [
                { codigo: 1, nome: `Deficiência de Nitrogênio`, tipo: `Nutricional`, nutriente: `Nitrogênio (N)`, partes_afetadas: `Folhas velhas`, sinais: `Folhas velhas ficam amareladas uniformemente; planta atrofiada.`, causa: `Falta de adubação nitrogenada ou substrato muito velho.`, condicoes: `Substrato decomposto.`, reversibilidade: `Sim`, severidade: `Média`, prejuizos: `Queda prematura de folhas, atraso no crescimento.`, manejo: `Adubação regular.`, tratamento: `Aplicar adubo rico em N (ex: 30-10-10).`, periodo: `Fase de crescimento.` },
                { codigo: 2, nome: `Excesso de Nitrogênio`, tipo: `Nutricional`, nutriente: `Nitrogênio (N)`, partes_afetadas: `Folhas e Tecidos`, sinais: `Verde muito escuro, tecidos moles, suscetibilidade a pragas.`, causa: `Adubação excessiva.`, condicoes: `Adubação frequente sem lavagem do substrato.`, reversibilidade: `Sim`, severidade: `Alta`, prejuizos: `Atraso na floração, podridões.`, manejo: `Seguir dosagem recomendada.`, tratamento: `Lavar substrato com água abundante, suspender adubação.`, periodo: `Todo o ciclo.` },
                { codigo: 3, nome: `Deficiência de Fósforo`, tipo: `Nutricional`, nutriente: `Fósforo (P)`, partes_afetadas: `Folhas e Raízes`, sinais: `Crescimento lento, folhas com tons avermelhados/arroxeados.`, causa: `Falta de P no adubo.`, condicoes: `pH inadequado.`, reversibilidade: `Sim`, severidade: `Média`, prejuizos: `Poucas raízes, floração escassa.`, manejo: `Adubação balanceada.`, tratamento: `Adubo rico em P (ex: 10-30-20).`, periodo: `Enraizamento e pré-floração.` },
                { codigo: 4, nome: `Excesso de Fósforo`, tipo: `Nutricional`, nutriente: `Fósforo (P)`, partes_afetadas: `Geral`, sinais: `Bloqueia micronutrientes (Fe, Zn); amadurecimento muito precoce.`, causa: `Excesso de adubo P.`, condicoes: `Adubação desbalanceada.`, reversibilidade: `Sim`, severidade: `Média`, prejuizos: `Deficiência induzida de micronutrientes.`, manejo: `Equilíbrio.`, tratamento: `Lixiviação.`, periodo: `Todo o ciclo.` },
                { codigo: 5, nome: `Deficiência de Potássio`, tipo: `Nutricional`, nutriente: `Potássio (K)`, partes_afetadas: `Folhas velhas`, sinais: `Bordas das folhas velhas amareladas/queimadas (necrose marginal).`, causa: `Falta de K.`, condicoes: `Excesso de Ca ou Mg (antagonismo).`, reversibilidade: `Parcial`, severidade: `Alta`, prejuizos: `Hastes fracas, fungos.`, manejo: `Equilíbrio na adubação.`, tratamento: `Adubo rico em K.`, periodo: `Maturação.` },
                { codigo: 6, nome: `Excesso de Potássio`, tipo: `Nutricional`, nutriente: `Potássio (K)`, partes_afetadas: `Raízes`, sinais: `Queima das pontas das raízes (salinidade); bloqueia Ca e Mg.`, causa: `Excesso de K.`, condicoes: `Substrato seco.`, reversibilidade: `Não (raízes)`, severidade: `Alta`, prejuizos: `Perda de raízes.`, manejo: `Rega abundante.`, tratamento: `Lixiviação.`, periodo: `Todo o ciclo.` },
                { codigo: 7, nome: `Deficiência de Cálcio`, tipo: `Nutricional`, nutriente: `Cálcio (Ca)`, partes_afetadas: `Brotos novos e Raízes`, sinais: `Morte dos brotos novos (necrose apical), folhas novas deformadas.`, causa: `Falta de Ca, pH ácido.`, condicoes: `Alta umidade, baixa transpiração.`, reversibilidade: `Não (tecido morto)`, severidade: `Muito Alta`, prejuizos: `Perda do broto principal.`, manejo: `Calcário ou Nitrato de Cálcio.`, tratamento: `Aplicação de Cálcio via foliar ou substrato.`, periodo: `Brotacao.` },
                { codigo: 8, nome: `Excesso de Cálcio`, tipo: `Nutricional`, nutriente: `Cálcio (Ca)`, partes_afetadas: `Geral`, sinais: `Bloqueia outros cátions; altera pH.`, causa: `Calagem excessiva.`, condicoes: `pH alcalino.`, reversibilidade: `Lenta`, severidade: `Média`, prejuizos: `Desequilíbrio nutricional.`, manejo: `Monitorar pH.`, tratamento: `Acidificar substrato se necessário.`, periodo: `Todo o ciclo.` },
                { codigo: 9, nome: `Deficiência de Magnésio`, tipo: `Nutricional`, nutriente: `Magnésio (Mg)`, partes_afetadas: `Folhas velhas`, sinais: `Clorose intervenal nas folhas velhas (nervuras verdes, meio amarelo).`, causa: `Falta de Mg.`, condicoes: `Excesso de K ou Ca.`, reversibilidade: `Sim`, severidade: `Média`, prejuizos: `Queda de folhas.`, manejo: `Sulfato de Magnésio.`, tratamento: `Aplicação de Mg.`, periodo: `Crescimento.` },
                { codigo: 10, nome: `Excesso de Magnésio`, tipo: `Nutricional`, nutriente: `Magnésio (Mg)`, partes_afetadas: `Geral`, sinais: `Bloqueia a absorção de Cálcio e Potássio.`, causa: `Excesso de adubo Mg.`, condicoes: `Desequilíbrio.`, reversibilidade: `Sim`, severidade: `Baixa`, prejuizos: `Deficiência induzida de K/Ca.`, manejo: `Equilíbrio.`, tratamento: `Lixiviação.`, periodo: `Todo o ciclo.` },
                { codigo: 11, nome: `Deficiência de Enxofre`, tipo: `Nutricional`, nutriente: `Enxofre (S)`, partes_afetadas: `Folhas novas`, sinais: `Semelhante ao Nitrogênio (amarelecimento), mas ocorre nas folhas novas.`, causa: `Falta de S.`, condicoes: `Substrato pobre.`, reversibilidade: `Sim`, severidade: `Média`, prejuizos: `Crescimento lento.`, manejo: `Sulfatos.`, tratamento: `Adubos com sulfato.`, periodo: `Crescimento.` },
                { codigo: 12, nome: `Excesso de Enxofre`, tipo: `Nutricional`, nutriente: `Enxofre (S)`, partes_afetadas: `Folhas`, sinais: `Acidificação excessiva do substrato; queima das bordas.`, causa: `Excesso de sulfatos.`, condicoes: `pH muito baixo.`, reversibilidade: `Parcial`, severidade: `Média`, prejuizos: `Queima de raízes.`, manejo: `Monitorar pH.`, tratamento: `Corrigir pH.`, periodo: `Todo o ciclo.` },
                { codigo: 13, nome: `Deficiência de Ferro`, tipo: `Nutricional`, nutriente: `Ferro (Fe)`, partes_afetadas: `Folhas novas`, sinais: `Clorose intervenal nas folhas novas (nascem amarelas, nervuras verdes).`, causa: `pH alcalino, excesso de P.`, condicoes: `Substrato alcalino.`, reversibilidade: `Sim`, severidade: `Média`, prejuizos: `Fotossíntese reduzida.`, manejo: `Quelatos de Ferro.`, tratamento: `Ajustar pH, aplicar Ferro.`, periodo: `Brotacao.` },
                { codigo: 14, nome: `Excesso de Ferro`, tipo: `Nutricional`, nutriente: `Ferro (Fe)`, partes_afetadas: `Folhas`, sinais: `Folhas com manchas escuras/bronzeamento; inibe absorção de Fósforo.`, causa: `Excesso de Fe.`, condicoes: `pH muito ácido.`, reversibilidade: `Não`, severidade: `Alta`, prejuizos: `Toxidez.`, manejo: `Cuidado com micronutrientes.`, tratamento: `Elevar pH.`, periodo: `Todo o ciclo.` },
                { codigo: 15, nome: `Deficiência de Boro`, tipo: `Nutricional`, nutriente: `Boro (B)`, partes_afetadas: `Gemas e Folhas novas`, sinais: `Morte da gema apical; folhas novas grossas, quebradiças ou deformadas.`, causa: `Falta de B.`, condicoes: `Seca.`, reversibilidade: `Não (dano estrutural)`, severidade: `Alta`, prejuizos: `Parada de crescimento.`, manejo: `Ácido bórico (cuidado).`, tratamento: `Aplicação foliar de B.`, periodo: `Crescimento.` },
                { codigo: 16, nome: `Excesso de Boro`, tipo: `Nutricional`, nutriente: `Boro (B)`, partes_afetadas: `Folhas`, sinais: `Queima nas pontas das folhas (necrose marginal); clorose.`, causa: `Excesso de B (margem estreita).`, condicoes: `Erro na dosagem.`, reversibilidade: `Não`, severidade: `Muito Alta`, prejuizos: `Morte de tecidos.`, manejo: `Dosagem precisa.`, tratamento: `Lixiviação intensa.`, periodo: `Todo o ciclo.` },
                { codigo: 17, nome: `Deficiência de Zinco`, tipo: `Nutricional`, nutriente: `Zinco (Zn)`, partes_afetadas: `Folhas novas`, sinais: `'Folha pequena' (roseta); internódios curtos; clorose em manchas.`, causa: `Falta de Zn.`, condicoes: `pH alto, excesso de P.`, reversibilidade: `Parcial`, severidade: `Média`, prejuizos: `Nanismo.`, manejo: `Sulfato de Zinco.`, tratamento: `Aplicação foliar.`, periodo: `Crescimento.` },
                { codigo: 18, nome: `Excesso de Zinco`, tipo: `Nutricional`, nutriente: `Zinco (Zn)`, partes_afetadas: `Geral`, sinais: `Induz deficiência de Ferro (clorose férrica).`, causa: `Excesso de Zn.`, condicoes: `Contaminação.`, reversibilidade: `Sim`, severidade: `Média`, prejuizos: `Clorose.`, manejo: `Cuidado com fungicidas.`, tratamento: `Lixiviação.`, periodo: `Todo o ciclo.` },
                { codigo: 19, nome: `Deficiência de Cobre`, tipo: `Nutricional`, nutriente: `Cobre (Cu)`, partes_afetadas: `Folhas novas`, sinais: `Folhas novas retorcidas ou deformadas; necrose nas pontas.`, causa: `Falta de Cu.`, condicoes: `Excesso de N.`, reversibilidade: `Não`, severidade: `Média`, prejuizos: `Deformação.`, manejo: `Sulfato de Cobre.`, tratamento: `Aplicação foliar.`, periodo: `Crescimento.` },
                { codigo: 20, nome: `Excesso de Cobre`, tipo: `Nutricional`, nutriente: `Cobre (Cu)`, partes_afetadas: `Raízes`, sinais: `Tóxico para as raízes (atrofia); induz deficiência de Ferro.`, causa: `Uso excessivo de fungicidas cúpricos.`, condicoes: `Acúmulo no substrato.`, reversibilidade: `Difícil`, severidade: `Alta`, prejuizos: `Morte radicular.`, manejo: `Rodízio de fungicidas.`, tratamento: `Replantio.`, periodo: `Todo o ciclo.` },
                { codigo: 21, nome: `Deficiência de Manganês`, tipo: `Nutricional`, nutriente: `Manganês (Mn)`, partes_afetadas: `Folhas novas`, sinais: `Clorose intervenal leve nas folhas novas; manchas necróticas pequenas.`, causa: `Falta de Mn.`, condicoes: `pH alto.`, reversibilidade: `Sim`, severidade: `Baixa`, prejuizos: `Estética.`, manejo: `Sulfato de Manganês.`, tratamento: `Aplicação foliar.`, periodo: `Crescimento.` },
                { codigo: 22, nome: `Excesso de Manganês`, tipo: `Nutricional`, nutriente: `Manganês (Mn)`, partes_afetadas: `Folhas velhas`, sinais: `Manchas marrons nas folhas velhas (semelhante a fungo); deficiência de Ferro.`, causa: `Excesso de Mn, pH baixo.`, condicoes: `Substrato ácido.`, reversibilidade: `Não`, severidade: `Média`, prejuizos: `Confusão com doenças.`, manejo: `Monitorar pH.`, tratamento: `Elevar pH.`, periodo: `Todo o ciclo.` },
                { codigo: 23, nome: `Deficiência de Molibdênio`, tipo: `Nutricional`, nutriente: `Molibdênio (Mo)`, partes_afetadas: `Folhas maduras`, sinais: `Semelhante à falta de Nitrogênio; manchas amarelas ('Yellow spot').`, causa: `Falta de Mo.`, condicoes: `pH ácido.`, reversibilidade: `Sim`, severidade: `Baixa`, prejuizos: `Metabolismo do N.`, manejo: `Molibdato de Sódio.`, tratamento: `Aplicação foliar/substrato.`, periodo: `Crescimento.` },
                { codigo: 24, nome: `Deficiência de Silício`, tipo: `Nutricional`, nutriente: `Silício (Si)`, partes_afetadas: `Estrutura`, sinais: `Planta estruturalmente mais fraca; maior incidência de pragas e fungos; bulbos moles.`, causa: `Falta de Si.`, condicoes: `Substrato inerte.`, reversibilidade: `Não`, severidade: `Média`, prejuizos: `Resistência baixa.`, manejo: `Silicato de Potássio.`, tratamento: `Aplicação regular.`, periodo: `Todo o ciclo.` },
                { codigo: 25, nome: `Queimadura Solar`, tipo: `Climático`, nutriente: `Luz`, partes_afetadas: `Folhas`, sinais: `Manchas brancas ou pretas secas na parte superior da folha.`, causa: `Excesso de luz direta.`, condicoes: `Mudança brusca de ambiente.`, reversibilidade: `Não`, severidade: `Média`, prejuizos: `Estética, porta para fungos.`, manejo: `Sombrite adequado.`, tratamento: `Mover para local mais sombreado.`, periodo: `Verão.` },
                { codigo: 26, nome: `Desidratação`, tipo: `Fisiológico`, nutriente: `Água`, partes_afetadas: `Pseudobulbos e Folhas`, sinais: `Pseudobulbos enrugados, folhas murchas e opacas.`, causa: `Falta de água ou raízes podres (não absorvem).`, condicoes: `Baixa umidade, substrato seco.`, reversibilidade: `Lenta`, severidade: `Alta`, prejuizos: `Estagnação.`, manejo: `Rega adequada.`, tratamento: `Hidratação, verificar raízes.`, periodo: `Seca.` }
            ],
            'motivos_replantio': [
                { codigo: 1, motivo: "Substrato velho ou degradado" },
                { codigo: 2, motivo: "Raízes deterioradas, podres ou doentes" },
                { codigo: 3, motivo: "Crescimento excessivo da planta (planta ficou apertada)" },
                { codigo: 4, motivo: "Presença de pragas no substrato" },
                { codigo: 5, motivo: "Após divisão da planta" },
                { codigo: 6, motivo: "Acúmulo de sais minerais" },
                { codigo: 7, motivo: "Vaso danificado, inadequado ou muito pequeno" },
                { codigo: 8, motivo: "Após salvar orquídea que estava em recuperação" },
                { codigo: 9, motivo: "Recomendação por tempo" },
                { codigo: 10, motivo: "Por segurança após a compra" },
                { codigo: 11, motivo: "Outro" }
            ],
            'locais_compra': [
                { codigo: 1, tipo_local: "Físico/Online", nome: "Emporium das Orquídeas 262", municipio_uf: "Venda nova do Imigrantes – ES", telefone: "", site: "https://emporiumdasorquideas262.com.br/" },
                { codigo: 2, tipo_local: "Físico/Online", nome: "Recanto das Orquídeas ES", municipio_uf: "Marechal Floriano – ES", telefone: "", site: "https://www.recantodasorquideases.com.br/" },
                { codigo: 3, tipo_local: "Físico", nome: "Orquidário Sávio Caliman", municipio_uf: "Venda nova do Imigrantes – ES", telefone: "", site: "Não possui." }
            ]
        };

        const AMBIENTES_SEED = [
            { codigo: "AMB001", local: "Peitoril de Janela (Interno)", tipo: "Interior", area: 0, orientacao: "Não definida" },
            { codigo: "AMB002", local: "Varanda de Apartamento (Aberta)", tipo: "Ar Livre", area: 0, orientacao: "Não definida" },
            { codigo: "AMB003", local: "Varanda Gourmet (Envidraçada)", tipo: "Interior", area: 0, orientacao: "Não definida" },
            { codigo: "AMB004", local: "Orquidário Telado (Sombrite)", tipo: "Sombrite", area: 0, orientacao: "Não definida" },
            { codigo: "AMB005", local: "Estufa Climatizada (Semi-profissional)", tipo: "Estufa", area: 0, orientacao: "Não definida" },
            { codigo: "AMB006", local: "Árvores do Quintal (Fixação natural)", tipo: "Ar Livre", area: 0, orientacao: "Não definida" },
            { codigo: "AMB007", local: "Pergolado de Madeira", tipo: "Sombrite", area: 0, orientacao: "Não definida" },
            { codigo: "AMB008", local: "Jardim de Inverno", tipo: "Interior", area: 0, orientacao: "Não definida" },
            { codigo: "AMB009", local: "Parede/Muro (Jardim Vertical)", tipo: "Ar Livre", area: 0, orientacao: "Não definida" },
            { codigo: "AMB010", local: "Área de Serviço (Bem iluminada)", tipo: "Interior", area: 0, orientacao: "Não definida" },
            { codigo: "AMB011", local: "Grow Tent (Cultivo Indoor com LED)", tipo: "Estufa", area: 0, orientacao: "Não definida" },
            { codigo: "AMB012", local: "Garagem (Aberta e iluminada)", tipo: "Ar Livre", area: 0, orientacao: "Não definida" },
            { codigo: "AMB013", local: "Gazebo de Jardim", tipo: "Ar Livre", area: 0, orientacao: "Não definida" },
            { codigo: "AMB014", local: "Sacada Norte (Muito Sol)", tipo: "Ar Livre", area: 0, orientacao: "Norte" },
            { codigo: "AMB015", local: "Sacada Sul (Pouco Sol)", tipo: "Ar Livre", area: 0, orientacao: "Sul" }
        ];

        const BASIC_SEEDS = {
            'generos': [
                { codigo: 1, genero: "Cattleya" }, { codigo: 2, genero: "Phalaenopsis" }, { codigo: 3, genero: "Dendrobium" },
                { codigo: 4, genero: "Oncidium" }, { codigo: 5, genero: "Vanda" }, { codigo: 6, genero: "Catasetum" },
                { codigo: 7, genero: "Laelia" }, { codigo: 8, genero: "Miltonia" }, { codigo: 9, genero: "Cymbidium" },
                { codigo: 10, genero: "Paphiopedilum" }, { codigo: 11, genero: "Epidendrum" }, { codigo: 12, genero: "Brassavola" },
                { codigo: 13, genero: "Encyclia" }, { codigo: 14, genero: "Zygopetalum" }, { codigo: 15, genero: "Bulbophyllum" },
                { codigo: 16, genero: "Coelogyne" }, { codigo: 17, genero: "Maxillaria" }, { codigo: 18, genero: "Lycaste" },
                { codigo: 19, genero: "Masdevallia" }, { codigo: 20, genero: "Angraecum" }, { codigo: 21, genero: "Sophronitis" },
                { codigo: 22, genero: "Prosthechea" }, { codigo: 23, genero: "Gomesa" }, { codigo: 24, genero: "Renanthera" },
                { codigo: 25, genero: "Aerides" }, { codigo: 26, genero: "Ascocenda" }, { codigo: 27, genero: "Rhynchostylis" },
                { codigo: 28, genero: "Phragmipedium" }, { codigo: 29, genero: "Stanhopea" }, { codigo: 30, genero: "Cycnoches" }
            ],
            'especies': [
                { codigo: 1, especie: "walkeriana" }, { codigo: 2, especie: "nobilior" }, { codigo: 3, especie: "amabilis" },
                { codigo: 4, especie: "loddigesii" }, { codigo: 5, especie: "intermedia" }, { codigo: 6, especie: "purpurata" },
                { codigo: 7, especie: "guttata" }, { codigo: 8, especie: "amethystoglossa" }, { codigo: 9, especie: "schilleriana" },
                { codigo: 10, especie: "aclandiae" }, { codigo: 11, especie: "labiata" }, { codigo: 12, especie: "mossiae" },
                { codigo: 13, especie: "trianae" }, { codigo: 14, especie: "warscewiczii" }, { codigo: 15, especie: "dowiana" },
                { codigo: 16, especie: "lueddemanniana" }, { codigo: 17, especie: "percivaliana" }, { codigo: 18, especie: "gaskelliana" },
                { codigo: 19, especie: "maxima" }, { codigo: 20, especie: "lawrenceana" }, { codigo: 21, especie: "skinneri" },
                { codigo: 22, especie: "bowringiana" }, { codigo: 23, especie: "aurantiaca" }, { codigo: 24, especie: "forbesii" },
                { codigo: 25, especie: "harrisoniana" }, { codigo: 26, especie: "granulosa" }, { codigo: 27, especie: "bicolor" },
                { codigo: 28, especie: "tenuis" }, { codigo: 29, especie: "elongata" }, { codigo: 30, especie: "velutina" },
                { codigo: 31, especie: "violacea" }, { codigo: 32, especie: "luteola" }, { codigo: 33, especie: "eldorado" },
                { codigo: 34, especie: "quadricolor" }, { codigo: 35, especie: "rex" }, { codigo: 36, especie: "iricolor" },
                { codigo: 37, especie: "mooreana" }, { codigo: 38, especie: "jenmanii" }, { codigo: 39, especie: "kerrii" },
                { codigo: 40, especie: "patinii" },
                { codigo: 41, especie: "anceps" }, { codigo: 42, especie: "rubescens" }, { codigo: 43, especie: "speciosa" },
                { codigo: 44, especie: "autumnalis" }, { codigo: 45, especie: "gouldiana" }, { codigo: 46, especie: "albida" },
                { codigo: 47, especie: "superbiens" }, { codigo: 48, especie: "jongheana" }, { codigo: 49, especie: "pumila" },
                { codigo: 50, especie: "praestans" }, { codigo: 51, especie: "dayana" }, { codigo: 52, especie: "alaorii" },
                { codigo: 53, especie: "sincorana" }, { codigo: 54, especie: "lundii" }, { codigo: 55, especie: "harpophylla" },
                { codigo: 56, especie: "amabilis" }, { codigo: 57, especie: "aphrodite" }, { codigo: 58, especie: "equestris" },
                { codigo: 59, especie: "schilleriana" }, { codigo: 60, especie: "stuartiana" }, { codigo: 61, especie: "philippinensis" },
                { codigo: 62, especie: "sanderiana" }, { codigo: 63, especie: "lueddemanniana" }, { codigo: 64, especie: "pulchra" },
                { codigo: 65, especie: "hieroglyphica" }, { codigo: 66, especie: "fasciata" }, { codigo: 67, especie: "violacea" },
                { codigo: 68, especie: "bellina" }, { codigo: 69, especie: "cornu-cervi" }, { codigo: 70, especie: "mannii" },
                { codigo: 71, especie: "nobile" }, { codigo: 72, especie: "anosmum" }, { codigo: 73, especie: "aphyllum" },
                { codigo: 74, especie: "fimbriatum" }, { codigo: 75, especie: "densiflorum" }, { codigo: 76, especie: "thyrsiflorum" },
                { codigo: 77, especie: "chrysotoxum" }, { codigo: 78, especie: "farmerii" }, { codigo: 79, especie: "lindleyi" },
                { codigo: 80, especie: "jenkinsii" }, { codigo: 81, especie: "loddigesii" }, { codigo: 82, especie: "primulinum" },
                { codigo: 83, especie: "parishii" }, { codigo: 84, especie: "kingianum" }, { codigo: 85, especie: "speciosum" },
                { codigo: 86, especie: "coerulea" }, { codigo: 87, especie: "sanderiana" }, { codigo: 88, especie: "tricolor" },
                { codigo: 89, especie: "luzonica" }, { codigo: 90, especie: "lamellata" }, { codigo: 91, especie: "merrillii" },
                { codigo: 92, especie: "tessellata" }, { codigo: 93, especie: "denisoniana" }, { codigo: 94, especie: "insignis" },
                { codigo: 95, especie: "bensonii" },
                { codigo: 96, especie: "flexuosum" }, { codigo: 97, especie: "varicosum" }, { codigo: 98, especie: "crispum" },
                { codigo: 99, especie: "forbesii" }, { codigo: 100, especie: "gardneri" }, { codigo: 101, especie: "marshallianum" },
                { codigo: 102, especie: "sarcodes" }, { codigo: 103, especie: "leucochilum" }, { codigo: 104, especie: "maculatum" },
                { codigo: 105, especie: "tigrinum" },
                { codigo: 106, especie: "hibrida" }, { codigo: 107, especie: "sp." }, { codigo: 108, especie: "alba" },
                { codigo: 109, especie: "semi-alba" }, { codigo: 110, especie: "coerulea" }, { codigo: 111, especie: "rubra" },
                { codigo: 112, especie: "vinicolor" }, { codigo: 113, especie: "concolor" }, { codigo: 114, especie: "suavissima" },
                { codigo: 115, especie: "flamea" }, { codigo: 116, especie: "aquinii" }, { codigo: 117, especie: "trilabelo" },
                { codigo: 118, especie: "striata" }, { codigo: 119, especie: "venosa" }, { codigo: 120, especie: "punctata" }
            ],
                    'variacao': [
        { codigo: 1, variacao: "Tipo" }, { codigo: 2, variacao: "Alba" }, { codigo: 3, variacao: "Coerulea" },
        { codigo: 4, variacao: "Rubra" }, { codigo: 5, variacao: "Semialba" }, { codigo: 6, variacao: "Vinicolor" },
        { codigo: 7, variacao: "Concolor" }, { codigo: 8, variacao: "Suavissima" }, { codigo: 9, variacao: "Flamea" },
        { codigo: 10, variacao: "Aquinii" }, { codigo: 11, variacao: "Trilabelo" }, { codigo: 12, variacao: "Striata" },
        { codigo: 13, variacao: "Venosa" }, { codigo: 14, variacao: "Punctata" }, { codigo: 15, variacao: "Amesiana" }
    ],
 	'formas_vida': [
        { codigo: 1, 
            nome: "Epífita", 
            descricao: "Crescem sobre árvores (troncos/galhos) apenas como suporte. Não são parasitas. Ex: Cattleya, Phalaenopsis, Catasetum."},
        { codigo: 2, 
            nome: "Terrestre", 
            descricao: "Crescem no solo. Preferem solo leve, rico em matéria orgânica e bem drenado. Ex: Habenaria, Paphiopedilum, Bletia."},
        { codigo: 3, 
            nome: "Rupícola", 
            descricao: "Crescem sobre rochas/fendas. Gostam de forte luminosidade e excelente drenagem. Ex: Laelia rupícolas (L. briegeri)."},
        { codigo: 4, 
            nome: "Litófita", 
            descricao: "Parecidas com rupícolas, mas crescem sobre pedras com musgo/detritos. Ex: Algumas espécies de Cymbidium e Oncidium."},
        { codigo: 5, 
            nome: "Humícola / Saprofita", 
            descricao: "São raras. Vivem em solos ricos em decomposição. Algumas sem clorofila (dependem de fungos). Ex: Corallorhiza (raras)."}
    ],
        // NOVO BLOCO: ADICIONE AQUI
        'habitats': [
            { codigo: 1, habitat: "Floresta Amazônica", regiao: "Norte (AM, PA, etc.)", descricao: "Ambiente úmido e sombreado, com alta pluviosidade (2.000-3.000 mm/ano). Orquídeas epífitas predominam em árvores altas. Temperatura: 25-30°C.", exemplos: "Cattleya walkeriana, Phalaenopsis amabilis, Oncidium flexuosum." },
            { codigo: 2, habitat: "Mata Atlântica", regiao: "Sudeste e Sul (RJ, SP, PR, etc.)", descricao: "Floresta densa com alta biodiversidade, umidade moderada e solos férteis. Muitas orquídeas litófitas e epífitas em troncos musgosos. Temperatura: 18-25°C.", exemplos: "Laelia purpurata, Cattleya loddigesii, Epidendrum secundum." },
            { codigo: 3, habitat: "Cerrado", regiao: "Centro-Oeste (GO, MT, etc.)", descricao: "Savana com solos pobres e drenados, estações secas marcadas. Orquídeas adaptadas à seca, muitas rupícolas em rochas. Temperatura: 20-28°C.", exemplos: "Hoffmannseggella cinnabarina, Habenaria humilis, Bulbophyllum." },
            { codigo: 4, habitat: "Caatinga", regiao: "Nordeste (BA, PE, etc.)", descricao: "Vegetação xerófila com baixa pluviosidade (300-800 mm/ano), solos arenosos. Orquídeas resistentes à seca, terrestres e litófitas em arbustos espinhosos.", exemplos: "Laelia briegeri, Cattleya granulosa, Encyclia." },
            { codigo: 5, habitat: "Pantanal", regiao: "Centro-Oeste (MS, MT)", descricao: "Área alagável com ciclos de inundação, solos úmidos e férteis. Orquídeas aquáticas ou semi-aquáticas em árvores inundáveis. Temperatura: 22-35°C.", exemplos: "Habenaria, Cyrtopodium, Oncidium." },
            { codigo: 6, habitat: "Serra do Mar / Montanha", regiao: "Sudeste (SP, RJ)", descricao: "Altitude elevada (500-2.000m), neblina e umidade constante. Orquídeas em névoa, litófitas em rochas úmidas e epífitas em bromélias.", exemplos: "Laelia lucasiana, Masdevallia, Pleurothallis." },
            { codigo: 7, habitat: "Restinga", regiao: "Litoral (RJ, SP, etc.)", descricao: "Vegetação costeira com solos arenosos e salinos, exposição ao vento. Orquídeas adaptadas à salinidade e luz intensa.", exemplos: "Epidendrum, Brassavola, Encyclia cordigera." },
            { codigo: 8, habitat: "Campos Rupestres", regiao: "Sudeste e Centro-Oeste (MG, GO)", descricao: "Áreas rochosas de altitude, solos finos e drenados. Predominam orquídeas rupícolas e litófitas resistentes ao fogo e seca.", exemplos: "Vriesea, Tillandsia (bromélias associadas), Laelia." },
            { codigo: 9, habitat: "Floresta de Araucária", regiao: "Sul (PR, SC)", descricao: "Floresta subtropical com invernos frios, solos vulcânicos. Orquídeas em troncos de araucárias, adaptadas ao frio.", exemplos: "Cattleya schilleriana, Epidendrum." }
        ]
    ],
        'origem': [
        { codigo: 1, local: "Amapá" },
        { codigo: 2, local: "Amazonas" },
        { codigo: 3, local: "Argentina" },
        { codigo: 4, local: "Bahia" },
        { codigo: 5, local: "Bolívia" },
        { codigo: 6, local: "Brasil" },
        { codigo: 7, local: "Ceará" },
        { codigo: 8, local: "Chile" },
        { codigo: 9, local: "China" },
        { codigo: 10, local: "Colômbia" },
        { codigo: 11, local: "Costa Rica" },
        { codigo: 12, local: "Cuba" },
        { codigo: 13, local: "Distrito Federal" },
        { codigo: 14, local: "El Salvador" },
        { codigo: 15, local: "Equador" },
        { codigo: 16, local: "Espírito Santo" },
        { codigo: 17, local: "Estados Unidos" },
        { codigo: 18, local: "Goiás" },
        { codigo: 19, local: "Guatemala" },
        { codigo: 20, local: "Haiti" },
        { codigo: 21, local: "Holanda" },
        { codigo: 22, local: "Honduras" },
        { codigo: 23, local: "Índia" },
        { codigo: 24, local: "Japão" },
        { codigo: 25, local: "Malásia" },
        { codigo: 26, local: "Maranhão" },
        { codigo: 27, local: "Mato Grosso" },
        { codigo: 28, local: "Mato Grosso do Sul" },
        { codigo: 29, local: "México" },
        { codigo: 30, local: "Minas Gerais" },
        { codigo: 31, local: "Panamá" },
        { codigo: 32, local: "Pará" },
        { codigo: 33, local: "Paraguai" },
        { codigo: 34, local: "Paraíba" },
        { codigo: 35, local: "Paraná" },
        { codigo: 36, local: "Pernambuco" },
        { codigo: 37, local: "Peru" },
        { codigo: 38, local: "Piauí" },
        { codigo: 39, local: "República Dominicana" },
        { codigo: 40, local: "Rio de Janeiro" },
        { codigo: 41, local: "Rio Grande do Norte" },
        { codigo: 42, local: "Rio Grande do Sul" },
        { codigo: 43, local: "Rondônia" },
        { codigo: 44, local: "Roraima" },
        { codigo: 45, local: "Santa Catarina" },
        { codigo: 46, local: "São Paulo" },
        { codigo: 47, local: "Sergipe" },
        { codigo: 48, local: "Singapura" },
        { codigo: 49, local: "Tailândia" },
        { codigo: 50, local: "Tocantins" },
        { codigo: 51, local: "Venezuela" }
    ],

    'vasos': [
        { codigo: 1, tipo: "Plástico", material: "Plástico", tamanho: "15cm", preco: "2,50", foto: "" },
        { codigo: 2, tipo: "Barro", material: "Cerâmica", tamanho: "20cm", preco: "15,00", foto: "" },
        { codigo: 3, tipo: "Cachepot", material: "Madeira", tamanho: "Médio", preco: "25,00", foto: "" },
        { codigo: 4, tipo: "Cuia", material: "Plástico", tamanho: "25cm", preco: "5,00", foto: "" },
        { codigo: 5, tipo: "Vaso Transparente", material: "Plástico", tamanho: "12cm", preco: "3,00", foto: "" }
    ],
            'vasos': [
                { codigo: 1, tipo: "Plástico", material: "Plástico", tamanho: "15cm", preco: "2,50", foto: "" },
                { codigo: 2, tipo: "Barro", material: "Cerâmica", tamanho: "20cm", preco: "15,00", foto: "" },
                { codigo: 3, tipo: "Cachepot", material: "Madeira", tamanho: "Médio", preco: "25,00", foto: "" },
                { codigo: 4, tipo: "Cuia", material: "Plástico", tamanho: "25cm", preco: "5,00", foto: "" },
                { codigo: 5, tipo: "Vaso Transparente", material: "Plástico", tamanho: "12cm", preco: "3,00", foto: "" }
            ],
            'substratos': [
                { codigo: 1, tipo: "Casca de Pinus", retencao: "Média", drenagem: "Alta", preco: "10,00", foto: "" },
                { codigo: 2, tipo: "Carvão Vegetal", retencao: "Baixa", drenagem: "Alta", preco: "8,00", foto: "" },
                { codigo: 3, tipo: "Sphagnum (Musgo)", retencao: "Alta", drenagem: "Média", preco: "30,00", foto: "" },
                { codigo: 4, tipo: "Mix Completo", retencao: "Média", drenagem: "Média", preco: "20,00", foto: "" },
                { codigo: 5, tipo: "Macadâmia", retencao: "Média", drenagem: "Alta", preco: "15,00", foto: "" },
                { codigo: 6, tipo: "Brita", retencao: "Baixa", drenagem: "Muito Alta", preco: "5,00", foto: "" }
            ],
            'adubos': [
                { codigo: 1, produto: "NPK 20-20-20", tipo: "Manutenção", aplicacao: "Foliar", preco: "25,00" },
                { codigo: 2, produto: "Bokashi", tipo: "Orgânico", aplicacao: "Substrato", preco: "35,00" },
                { codigo: 3, produto: "Osmocote", tipo: "Liberação Lenta", aplicacao: "Substrato", preco: "50,00" },
                { codigo: 4, produto: "NPK 10-30-20", tipo: "Floração", aplicacao: "Foliar", preco: "28,00" },
                { codigo: 5, produto: "Cálcio", tipo: "Nutrição", aplicacao: "Foliar", preco: "20,00" }
            ],
            'defensivos': [
                { codigo: 1, nome: "Óleo de Neem", classe: "Sem toxidade", epi: "Não", preco: "20,00" },
                { codigo: 2, nome: "Enxofre Dimy", classe: "Classe 4", epi: "Sim", preco: "15,00" },
                { codigo: 3, nome: "Calda Bordalesa", classe: "Classe 4", epi: "Sim", preco: "18,00" },
                { codigo: 4, nome: "Mancozeb", classe: "Classe 3", epi: "Sim", preco: "40,00" },
                { codigo: 5, nome: "Kasugamicina", classe: "Classe 3", epi: "Sim", preco: "55,00" }
            ],
            'locais_compra': [
                { codigo: 1, tipo_local: "Físico/Online", nome: "Emporium das Orquídeas 262", municipio_uf: "Venda nova do Imigrantes – ES", telefone: "", site: "https://emporiumdasorquideas262.com.br/" },
                { codigo: 2, tipo_local: "Físico/Online", nome: "Recanto das Orquídeas ES", municipio_uf: "Marechal Floriano – ES", telefone: "", site: "https://www.recantodasorquideases.com.br/" },
                { codigo: 3, tipo_local: "Físico", nome: "Orquidário Sávio Caliman", municipio_uf: "Venda nova do Imigrantes – ES", telefone: "", site: "Não possui." }
            ]
        };

        // ==================================================================
        // 2. LÓGICA DO SISTEMA (DB, UI, APP, AUTH)
        // ==================================================================

        const DB = {
            get: (table) => {
                try {
                    const data = localStorage.getItem(`sas_${table}`);
                    return data ? JSON.parse(data) : [];
                } catch (e) {
                    console.error("Erro DB.get:", e);
                    return [];
                }
            },
            add: (table, record) => {
                try {
                    const list = DB.get(table);
                    list.push(record);
                    localStorage.setItem(`sas_${table}`, JSON.stringify(list));
                } catch (e) {
                    alert("Erro ao salvar: " + e.message);
                }
            },
            update: (table, index, record) => {
                try {
                    const list = DB.get(table);
                    list[index] = record;
                    localStorage.setItem(`sas_${table}`, JSON.stringify(list));
                } catch (e) {
                    alert("Erro ao atualizar: " + e.message);
                }
            },
            delete: (table, index) => {
                try {
                    const list = DB.get(table);
                    list.splice(index, 1);
                    localStorage.setItem(`sas_${table}`, JSON.stringify(list));
                } catch (e) {
                    alert("Erro ao excluir: " + e.message);
                }
            },
            getNextId: (table) => {
                const list = DB.get(table);
                if (list.length === 0) return 1;
                const maxId = list.reduce((max, item) => Math.max(max, Number(item.codigo) || 0), 0);
                return maxId + 1;
            }
        };

        // --- UI (DEFINIDA ANTES DO APP PARA EVITAR ERRO) ---
        const UI = {
            currentTable: null,
            currentIndex: 0,
            filteredData: [],
            activeCharts: [],
            showAlerts: localStorage.getItem('sas_settings_alerts') === 'true',

            toggleSidebar: () => {
                const sidebar = document.getElementById('sidebar');
                const overlay = document.querySelector('.sidebar-overlay');
                sidebar.classList.toggle('active');
                overlay.classList.toggle('active');
            },

            showToast: (msg) => {
                const t = document.getElementById('toast');
                document.getElementById('toast-msg').innerText = msg;
                t.classList.add('show');
                setTimeout(() => t.classList.remove('show'), 3000);
            },

            renderMenu: () => {
                const nav = document.getElementById('main-nav');
                const menuStructure = [
                    { label: 'Dashboard', icon: 'fa-chart-pie', action: 'App.loadDashboard()' },
                    { label: 'Financeiro', icon: 'fa-wallet', action: 'App.loadFinancial()' },
                    { label: 'Cadastros Básicos', icon: 'fa-tags', subs: ['generos', 'especies', 'variacao', 'habitats', 'origem', 'locais_compra', 'motivos_replantio'] },
                    { label: 'Estrutura', icon: 'fa-warehouse', subs: ['ambientes', 'vasos', 'substratos'] },
                    { label: 'Insumos', icon: 'fa-flask', subs: ['adubos', 'defensivos'] },
                    { label: 'Fitossanitário', icon: 'fa-bug', subs: ['pragas', 'doencas', 'disturbios'] },
                    { label: 'Minhas Orquídeas', icon: 'fa-seedling', action: "App.loadTable('orquideas')" },
		    { label: 'Diário de Campo', icon: 'fa-calendar-alt', subs: ['replantios', 'nutricao', 'aplicacao_defensivos', 'agendamentos'] },
		    { label: 'Lembretes', icon: 'fa-bell', subs: ['lembretes', 'execucoes_lembretes'] },
		    { label: 'Lembretes Pendentes', icon: 'fa-exclamation-circle', action: "App.showLembretesAtivos()" },
                    { label: 'Relatórios', icon: 'fa-print', action: "App.loadReports()" },
                    { label: 'Segurança & Backup', icon: 'fa-shield-alt', action: "App.loadBackupScreen()" }
                ];

                let html = '';
                menuStructure.forEach((item, idx) => {
                    if (item.subs) {
                        html += `
                            <div class="menu-item" onclick="document.getElementById('sub-${idx}').classList.toggle('open')">
                                <span><i class="fas ${item.icon} icon-left"></i> ${item.label}</span>
                                <i class="fas fa-chevron-down" style="font-size:0.7rem"></i>
                            </div>
                            <div class="submenu" id="sub-${idx}">
                                ${item.subs.map(key => `
                                    <div class="submenu-item" onclick="App.loadTable('${key}'); UI.toggleSidebar()">
                                        ${SCHEMAS[key].label}
                                    </div>
                                `).join('')}
                            </div>
                        `;
                    } else {
                        html += `
                            <div class="menu-item" onclick="${item.action}; UI.toggleSidebar()">
                                <span><i class="fas ${item.icon} icon-left"></i> ${item.label}</span>
                            </div>
                        `;
                    }
                });
                nav.innerHTML = html;
            },

            toggleAlerts: () => {
                UI.showAlerts = !UI.showAlerts;
                localStorage.setItem('sas_settings_alerts', UI.showAlerts);
                if(UI.currentTable) UI.renderTable(UI.currentTable);
            },

            getAlertIcons: (row, tableKey) => {
                if (!UI.showAlerts || tableKey !== 'orquideas') return '';
                
                let icons = '';
                const today = new Date();
                const currentMonth = today.toLocaleString('pt-BR', { month: 'long' }).toLowerCase();

                if (row.prox_replantio) {
                    const replantDate = new Date(row.prox_replantio);
                    if (replantDate < today) {
                        icons += `<i class="fas fa-exclamation-circle alert-icon alert-repot" title="Replantio Atrasado"></i>`;
                    }
                }

                if (row.floracao && row.floracao.toLowerCase().includes(currentMonth)) {
                    icons += `<i class="fas fa-spa alert-icon alert-flower" title="Época de Floração"></i>`;
                }

                const nutricoes = DB.get('nutricao');
                const lastNutri = nutricoes
                    .filter(n => n.orquidea == row.codigo || n.orquidea == `${row.genero} ${row.especie}`)
                    .sort((a,b) => new Date(b.data) - new Date(a.data))[0];

                if (!lastNutri) {
                    icons += `<i class="fas fa-flask alert-icon alert-food" title="Nunca Adubada"></i>`;
                } else {
                    const daysSince = (today - new Date(lastNutri.data)) / (1000 * 60 * 60 * 24);
                    if (daysSince > 30) {
                        icons += `<i class="fas fa-flask alert-icon alert-food" title="Adubação Atrasada"></i>`;
                    }
                }

                return icons;
            },

            renderTable: (tableKey) => {
                if (UI.currentTable !== tableKey) {
                    UI.currentTable = tableKey;
                    UI.currentIndex = 0;
                    UI.filteredData = DB.get(tableKey);
                }

                const schema = SCHEMAS[tableKey];
                const totalRecords = UI.filteredData.length;
                const currentRecord = totalRecords > 0 ? UI.filteredData[UI.currentIndex] : null;

                document.getElementById('header-title').innerText = schema.label;
                
                const alertBtnClass = UI.showAlerts ? 'btn-alert-on' : 'btn-alert-off';
                const alertBtnText = UI.showAlerts ? 'ON' : 'OFF';

                let html = `
                    <div class="card">
                        <div class="toolbar" style="display:flex; justify-content:space-between; margin-bottom:20px; flex-wrap:wrap; gap:10px;">
                            <div style="position:relative; width:100%; max-width:300px;">
                                <i class="fas fa-search" style="position:absolute; left:10px; top:10px; color:#aaa;"></i>
                                <input type="text" placeholder="Pesquisar..." onkeyup="UI.filterTable(this.value)" 
                                    style="width:100%; padding:8px 10px 8px 35px; border:1px solid #ddd; border-radius:20px;">
                            </div>
                            <div style="display:flex; gap:10px; flex-wrap:wrap;">
                                ${tableKey === 'orquideas' ? 
                                    `<button class="btn ${alertBtnClass}" onclick="UI.toggleAlerts()">
                                        <i class="fas fa-bell"></i> Alertas: ${alertBtnText}
                                    </button>` : ''}
                                <button class="btn btn-excel" onclick="App.exportCSV('${tableKey}')">
                                    <i class="fas fa-file-csv"></i> Exportar
                                </button>
                            </div>
                        </div>
                        
                        <div class="record-view">
                            ${totalRecords === 0 ? '<p style="text-align:center; color:#777;">Nenhum registro encontrado.</p>' : ''}
                            
                            ${currentRecord ? `
                                <div class="form-grid">
                                    ${schema.fields.map(f => {
                                        if (f.type === 'image') return ''; 
                                        
                                        let val = currentRecord[f.key] || '-';
                                        if (f.type === 'date' && val !== '-') val = App.formatDate(val);
                                        if (f.type === 'money') val = App.formatMoney(App.parseMoney(val));
                                        
                                        let alertIcon = '';
                                        if (f.key === 'genero' && tableKey === 'orquideas') {
                                            alertIcon = UI.getAlertIcons(currentRecord, tableKey);
                                        }

                                        return `
                                            <div class="record-field">
                                                <span class="record-label">${f.label}</span>
                                                <span class="record-value">${alertIcon} ${val}</span>
                                            </div>
                                        `;
                                    }).join('')}
                                </div>

                                ${(() => {
                                    const imageFields = schema.fields.filter(f => f.type === 'image');
                                    return imageFields.map(f => {
                                        const imgData = currentRecord[f.key];
                                        if (imgData && imgData.length > 50) {
                                            return `
                                                <div class="record-image-container">
                                                    <span class="record-image-label">${f.label}</span>
                                                    <img src="${imgData}" class="record-image">
                                                </div>
                                            `;
                                        }
                                        return '';
                                    }).join('');
                                })()}
                            ` : ''}

                            <div class="control-bar">
                                <div class="nav-group">
                                    <button class="btn-nav" onclick="UI.navFirst()" ${totalRecords <= 1 ? 'disabled' : ''}><i class="fas fa-angle-double-left"></i></button>
                                    <button class="btn-nav" onclick="UI.navPrev()" ${totalRecords <= 1 ? 'disabled' : ''}><i class="fas fa-angle-left"></i></button>
                                    <span style="display:flex; align-items:center; padding:0 10px; font-weight:bold; color:var(--cinza);">
                                        ${totalRecords > 0 ? UI.currentIndex + 1 : 0} / ${totalRecords}
                                    </span>
                                    <button class="btn-nav" onclick="UI.navNext()" ${totalRecords <= 1 ? 'disabled' : ''}><i class="fas fa-angle-right"></i></button>
                                    <button class="btn-nav" onclick="UI.navLast()" ${totalRecords <= 1 ? 'disabled' : ''}><i class="fas fa-angle-double-right"></i></button>
                                </div>
                                <div class="action-group">
                                    <button class="btn btn-primary" onclick="UI.openModal('${tableKey}')"><i class="fas fa-plus"></i> Novo</button>
                                    ${currentRecord ? `
                                        <button class="btn btn-edit" onclick="App.edit('${tableKey}', ${UI.getRealIndex(currentRecord)})"><i class="fas fa-pen"></i> Editar</button>
                                        <button class="btn btn-danger" onclick="App.delete('${tableKey}', ${UI.getRealIndex(currentRecord)})"><i class="fas fa-trash"></i> Deletar</button>
                                        ${tableKey === 'orquideas' ? `<button class="btn btn-qr" onclick="App.generateQR(${currentRecord.codigo}, '${currentRecord.genero} ${currentRecord.especie}')"><i class="fas fa-qrcode"></i></button>` : ''}
                                    ` : ''}
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                document.getElementById('app-content').innerHTML = html;
            },

            navFirst: () => { UI.currentIndex = 0; UI.renderTable(UI.currentTable); },
            navPrev: () => { if (UI.currentIndex > 0) { UI.currentIndex--; UI.renderTable(UI.currentTable); } },
            navNext: () => { if (UI.currentIndex < UI.filteredData.length - 1) { UI.currentIndex++; UI.renderTable(UI.currentTable); } },
            navLast: () => { UI.currentIndex = UI.filteredData.length - 1; UI.renderTable(UI.currentTable); },

            filterTable: (term) => {
                const allData = DB.get(UI.currentTable);
                if (!term) {
                    UI.filteredData = allData;
                } else {
                    term = term.toLowerCase();
                    UI.filteredData = allData.filter(item => {
                        return Object.values(item).some(val => 
                            String(val).toLowerCase().includes(term)
                        );
                    });
                }
                UI.currentIndex = 0; 
                UI.renderTable(UI.currentTable);
            },

            getRealIndex: (record) => {
                const allData = DB.get(UI.currentTable);
                return allData.findIndex(item => item.codigo === record.codigo);
            },

            openModal: (tableKey, editIndex = null) => {
                tableKey = tableKey || UI.currentTable;
                UI.editingIndex = editIndex;
                const schema = SCHEMAS[tableKey];
                
                if (editIndex !== null) {
                    document.getElementById('modal-title').innerText = `Editar: ${schema.label}`;
                    document.getElementById('btn-save-new').style.display = 'none';
                    document.getElementById('btn-save-close').innerHTML = '<i class="fas fa-save"></i> Salvar';
                } else {
                    document.getElementById('modal-title').innerText = `Novo: ${schema.label}`;
                    document.getElementById('btn-save-new').style.display = 'inline-flex';
                    document.getElementById('btn-save-close').innerHTML = '<i class="fas fa-check"></i> Salvar';
                }

                const container = document.getElementById('modal-fields');
                container.innerHTML = '';

                let recordData = {};
                let nextId = DB.getNextId(tableKey);
                
                if (editIndex !== null) {
                    const list = DB.get(tableKey);
                    recordData = list[editIndex];
                    nextId = recordData.codigo;
                }

                schema.fields.forEach(f => {
                    let input = '';
                    const value = recordData[f.key] || '';

                    if (f.type === 'readonly') {
                        input = `<input type="text" id="field-${f.key}" class="form-control readonly-field" value="${f.key === 'codigo' ? nextId : value}" readonly>`;
                    } else if (f.type === 'select') {
                        input = `<select id="field-${f.key}" class="form-control">
                            <option value="">Selecione...</option>
                            ${f.options.map(o => `<option value="${o}" ${o === value ? 'selected' : ''}>${o}</option>`).join('')}
                        </select>`;
                    } else if (f.type === 'lookup') {
                        const sourceData = DB.get(f.source);
                        const sourceSchema = SCHEMAS[f.source];
                        const descField = sourceSchema.fields.find(sf => sf.key !== 'codigo') || sourceSchema.fields[0];
                        
                        const listId = `list-${f.key}`;
                        const options = sourceData.map(item => {
                            let label = '';
                            if (f.source === 'orquideas') {
                                label = `#${item.codigo} - ${item.genero} ${item.especie} (${item.variacao || ''})`;
                            } else {
                                label = item[descField.key];
                            }
                            return `<option value="${label}">`;
                        }).join('');

                        input = `
                            <input type="text" id="field-${f.key}" class="form-control" list="${listId}" 
                                value="${value}" placeholder="Digite para buscar..."
                                onchange="App.validateAutocomplete(this, '${f.source}', '${SCHEMAS[f.source].label}')">
                            <datalist id="${listId}">${options}</datalist>
                        `;
                        
                    } else if (f.type === 'date') {
                        input = `<input type="date" id="field-${f.key}" class="form-control" value="${value}">`;
                    } else if (f.type === 'number') {
                        input = `<input type="number" id="field-${f.key}" class="form-control" value="${value}">`;
                    } else if (f.type === 'money') {
                        input = `<input type="text" id="field-${f.key}" class="form-control" value="${value}" placeholder="R$ 0,00">`;
                    } else if (f.type === 'image') {
                        const hasImage = value && value.length > 10;
                        input = `
                            <div class="drop-zone ${hasImage ? 'preview-active' : ''}" id="drop-${f.key}" 
                                 onclick="document.getElementById('file-${f.key}').click()">
                                <div class="default-content">
                                    <i class="fas fa-cloud-upload-alt"></i>
                                    <p>Toque para foto</p>
                                </div>
                                <img src="${hasImage ? value : ''}" class="preview-img" id="preview-${f.key}">
                                <input type="file" id="file-${f.key}" hidden accept="image/*" onchange="UI.handleImage(this, '${f.key}')">
                                <input type="hidden" id="field-${f.key}" value="${value}">
                            </div>
                        `;
                    } else {
                        input = `<input type="text" id="field-${f.key}" class="form-control" value="${value}">`;
                    }

                    container.innerHTML += `
                        <div class="form-group">
                            <label>${f.label}</label>
                            ${input}
                        </div>
                    `;

                    if (f.type === 'image') {
                        setTimeout(() => UI.setupDragDrop(f.key), 100);
                    }
                });

                if (tableKey === 'agendamentos') {
                    const typeSelect = document.getElementById('field-tipo');
                    const productSelect = document.getElementById('field-detalhes');
                    const updateProducts = () => {
                        const type = typeSelect.value;
                        let options = [];
                        if (type === 'Adubação') options = DB.get('adubos').map(a => a.produto);
                        else if (type === 'Defensivos') options = DB.get('defensivos').map(d => d.nome);
                        productSelect.innerHTML = '<option value="">Selecione...</option>';
                        options.forEach(opt => {
                            const option = document.createElement('option');
                            option.value = opt; option.text = opt; productSelect.appendChild(option);
                        });
                    };
                    typeSelect.addEventListener('change', updateProducts);
                    if (editIndex !== null) {
                        updateProducts();
                        productSelect.value = recordData.detalhes;
                    }
                }

                document.getElementById('modal-cadastro').style.display = 'flex';
            },

            closeModal: () => {
                document.getElementById('modal-cadastro').style.display = 'none';
                UI.editingIndex = null;
            },

            resetModal: () => {
                const schema = SCHEMAS[UI.currentTable];
                const nextId = DB.getNextId(UI.currentTable);
                const idField = document.getElementById('field-codigo');
                if(idField) idField.value = nextId;
                schema.fields.forEach(f => {
                    if(f.key !== 'codigo') {
                        const el = document.getElementById(`field-${f.key}`);
                        if(el) el.value = '';
                        if(f.type === 'image') {
                            const dropZone = document.getElementById(`drop-${f.key}`);
                            if(dropZone) dropZone.classList.remove('preview-active');
                        }
                    }
                });
            },

            setupDragDrop: (key) => {
                const dropZone = document.getElementById(`drop-${key}`);
                if(!dropZone) return;
                ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                    dropZone.addEventListener(eventName, (e) => { e.preventDefault(); e.stopPropagation(); }, false);
                });
                dropZone.addEventListener('dragover', () => dropZone.classList.add('dragover'));
                dropZone.addEventListener('dragleave', () => dropZone.classList.remove('dragover'));
                dropZone.addEventListener('drop', (e) => {
                    dropZone.classList.remove('dragover');
                    const dt = e.dataTransfer;
                    if(dt.files.length > 0) UI.processFile(dt.files[0], key);
                });
            },

            handleImage: (input, key) => {
                if (input.files && input.files[0]) UI.processFile(input.files[0], key);
            },

            processFile: (file, key) => {
                const reader = new FileReader();
                reader.onload = (e) => {
                    const img = new Image();
                    img.src = e.target.result;
                    img.onload = () => {
                        const canvas = document.createElement('canvas');
                        const ctx = canvas.getContext('2d');
                        const MAX_WIDTH = 600;
                        let width = img.width;
                        let height = img.height;
                        if (width > MAX_WIDTH) {
                            height *= MAX_WIDTH / width;
                            width = MAX_WIDTH;
                        }
                        canvas.width = width;
                        canvas.height = height;
                        ctx.drawImage(img, 0, 0, width, height);
                        const dataUrl = canvas.toDataURL('image/jpeg', 0.7);
                        document.getElementById(`field-${key}`).value = dataUrl;
                        document.getElementById(`preview-${key}`).src = dataUrl;
                        document.getElementById(`drop-${key}`).classList.add('preview-active');
                    };
                };
                reader.readAsDataURL(file);
            }
        };

        const App = {
            init: () => {
                // --- RESTAURAÇÃO INTELIGENTE (V79.0) ---
                // Verifica se as tabelas principais estão vazias e restaura os dados
                
                if (DB.get('pragas').length === 0) {
                    localStorage.setItem('sas_pragas', JSON.stringify(INITIAL_DATA.pragas));
                    console.log("Pragas restauradas.");
                }

                if (DB.get('disturbios').length === 0) {
                    localStorage.setItem('sas_disturbios', JSON.stringify(INITIAL_DATA.disturbios));
                    console.log("Distúrbios restaurados.");
                }

                if (DB.get('doencas').length === 0) {
                    localStorage.setItem('sas_doencas', JSON.stringify(INITIAL_DATA.doencas));
                    console.log("Doenças restauradas.");
                }

                if (DB.get('ambientes').length === 0) {
                    localStorage.setItem('sas_ambientes', JSON.stringify(AMBIENTES_SEED));
                    console.log("Ambientes restaurados.");
                }

                // --- RESTAURAÇÃO DE DADOS AUXILIARES (V79.0) ---
                // Força a atualização das espécies se houver menos de 10 (indicando versão antiga ou reset)
                if (DB.get('especies').length < 10) {
                    localStorage.setItem('sas_especies', JSON.stringify(BASIC_SEEDS.especies));
                    console.log("Espécies (120+) restauradas.");
                }

                // FORÇA A ATUALIZAÇÃO DA TABELA LOCAIS DE COMPRA (V79)
                // Isso garante que os 9 registros antigos sejam substituídos pelos 3 novos
                if (localStorage.getItem('sas_seed_version_locais') !== 'v79_update') {
                    localStorage.setItem('sas_locais_compra', JSON.stringify(BASIC_SEEDS.locais_compra));
                    localStorage.setItem('sas_seed_version_locais', 'v79_update');
                    console.log("Tabela Onde foi Comprada atualizada com sucesso.");
                }

                // Restaura outras tabelas se estiverem vazias
                Object.keys(BASIC_SEEDS).forEach(key => {
                    if (key !== 'especies' && key !== 'locais_compra' && DB.get(key).length === 0) {
                        localStorage.setItem(`sas_${key}`, JSON.stringify(BASIC_SEEDS[key]));
                        console.log(`${key} restaurados.`);
                    }
                });

                // Marca que o reset de fábrica já ocorreu para não rodar a lógica antiga
                if (!localStorage.getItem('sas_v33_factory_reset')) {
                    localStorage.setItem('sas_v33_factory_reset', 'true');
                }

                // --- CARREGAMENTO DA LOGO PERSONALIZADA ---
                App.loadLogo();

                UI.renderMenu();
                if(localStorage.getItem('sas_license_key')) {
                    App.loadDashboard();
                }
                
                const params = new URLSearchParams(window.location.search);
                if(params.get('action') === 'view' && params.get('table') === 'orquideas') {
                    const id = params.get('id');
                    const data = DB.get('orquideas');
                    const index = data.findIndex(i => i.codigo == id);
                    if(index >= 0) {
                        UI.openModal('orquideas', index);
                    }
                }
            },

            // --- FUNÇÕES DE LOGO PERSONALIZADA ---
            loadLogo: () => {
                const customLogo = localStorage.getItem('sas_custom_logo');
                if (customLogo) {
                    const loginImg = document.getElementById('login-logo-img');
                    const sidebarImg = document.getElementById('sidebar-logo-img');
                    if(loginImg) {
                        loginImg.src = customLogo;
                        loginImg.style.display = 'block';
                        document.getElementById('login-icon-fallback').style.display = 'none';
                    }
                    if(sidebarImg) {
                        sidebarImg.src = customLogo;
                        sidebarImg.style.display = 'block';
                        document.getElementById('sidebar-icon-fallback').style.display = 'none';
                    }
                }
            },

            changeLogo: (input) => {
                if (input.files && input.files[0]) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        const base64 = e.target.result;
                        localStorage.setItem('sas_custom_logo', base64);
                        App.loadLogo();
                        UI.showToast('Logomarca atualizada com sucesso!');
                    };
                    reader.readAsDataURL(input.files[0]);
                }
            },

            validateAutocomplete: (input, table, tableName) => {
                const val = input.value.trim();
                if(!val) return; 

                const data = DB.get(table);
                const schema = SCHEMAS[table];
                const descField = schema.fields.find(sf => sf.key !== 'codigo') || schema.fields[0];

                const exists = data.some(item => {
                    let label = '';
                    if (table === 'orquideas') {
                        label = `#${item.codigo} - ${item.genero} ${item.especie} (${item.variacao || ''})`;
                    } else {
                        label = item[descField.key];
                    }
                    return label === val;
                });

                if (!exists) {
                    alert(`O item "${val}" não consta no cadastro de ${tableName}.\n\nPor favor, vá ao menu correspondente, cadastre-o e retorne para finalizar.`);
                    input.value = ''; 
                    input.focus(); 
                }
            },

            parseMoney: (str) => {
                if(!str) return 0;
                let clean = str.toString().replace(/[R$\s.]/g, '').replace(',', '.');
                return parseFloat(clean) || 0;
            },

            formatMoney: (num) => {
                return num.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
            },

            formatDate: (dateStr) => {
                if(!dateStr) return '-';
                const [year, month, day] = dateStr.split('-');
                return `${day}/${month}/${year}`;
            },

            loadDashboard: () => {
                const totalOrq = DB.get('orquideas').length;
                const totalEsp = DB.get('especies').length;
                const today = new Date();
                const future = new Date();
                future.setDate(today.getDate() + 30);
                
                const replantios = DB.get('orquideas').filter(o => {
                    if(!o.prox_replantio) return false;
                    const d = new Date(o.prox_replantio);
                    return d >= today && d <= future;
                }).length;

                const orquideas = DB.get('orquideas');
                
                const generosCount = {};
                orquideas.forEach(o => {
                    const g = o.genero || 'Não definido';
                    generosCount[g] = (generosCount[g] || 0) + 1;
                });

                const especiesCount = {};
                orquideas.forEach(o => {
                    const e = o.especie || 'Não definido';
                    especiesCount[e] = (especiesCount[e] || 0) + 1;
                });
                const sortedEspecies = Object.entries(especiesCount)
                    .sort((a,b) => b[1] - a[1])
                    .slice(0, 5);

                let emDia = 0, atrasado = 0;
                const now = new Date();
                orquideas.forEach(o => {
                    if(o.prox_replantio) {
                        new Date(o.prox_replantio) < now ? atrasado++ : emDia++;
                    }
                });

                const palette = [
                    '#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0', '#9966FF', 
                    '#FF9F40', '#C9CBCF', '#2D5016', '#E8B71B', '#4A7C3C'
                ];

                const agendamentos = DB.get('agendamentos');

                const listReplantios = orquideas
                    .filter(o => o.prox_replantio)
                    .map(o => ({ ...o, dateObj: new Date(o.prox_replantio) }))
                    .filter(o => o.dateObj >= new Date(new Date().setHours(0,0,0,0)))
                    .sort((a, b) => a.dateObj - b.dateObj)
                    .slice(0, 5);

                const listAdubos = agendamentos
                    .filter(a => a.tipo === 'Adubação' && a.status === 'Pendente' && a.data)
                    .map(a => ({ ...a, dateObj: new Date(a.data) }))
                    .filter(a => a.dateObj >= new Date(new Date().setHours(0,0,0,0)))
                    .sort((a, b) => a.dateObj - b.dateObj)
                    .slice(0, 5);

                const listDefensivos = agendamentos
                    .filter(a => a.tipo === 'Defensivos' && a.status === 'Pendente' && a.data)
                    .map(a => ({ ...a, dateObj: new Date(a.data) }))
                    .filter(a => a.dateObj >= new Date(new Date().setHours(0,0,0,0)))
                    .sort((a, b) => a.dateObj - b.dateObj)
                    .slice(0, 5);

                const renderList = (list, type) => {
                    if (list.length === 0) return '<div style="color:#999; padding:10px; font-size:0.9rem;">Nenhum agendamento.</div>';
                    let html = '<ul class="agenda-list">';
                    list.forEach(item => {
                        let label = '';
                        let tagClass = '';
                        let date = '';

                        if (type === 'replantio') {
                            label = `#${item.codigo} - ${item.genero} ${item.especie}`;
                            tagClass = 'tag-repot';
                            date = item.prox_replantio;
                        } else {
                            label = item.detalhes || 'Sem detalhes';
                            tagClass = type === 'adubo' ? 'tag-adubo' : 'tag-defensivo';
                            date = item.data;
                        }

                        html += `
                            <li class="agenda-item">
                                <div>
                                    <span class="agenda-date">${App.formatDate(date)}</span>
                                    <br>
                                    <small>${label}</small>
                                </div>
                                <div class="${tagClass}">${type === 'replantio' ? 'Replantio' : (type === 'adubo' ? 'Adubação' : 'Defensivo')}</div>
                            </li>
                        `;
                    });
                    return html + '</ul>';
                };

                document.getElementById('header-title').innerText = 'Dashboard';
                document.getElementById('app-content').innerHTML = `
                    <div class="dash-grid">
                        <div class="kpi-card">
                            <h4>Total de Orquídeas</h4>
                            <div class="value">${totalOrq}</div>
                        </div>
                        <div class="kpi-card" style="border-left-color: var(--destaque)">
                            <h4>Replantios Pendentes</h4>
                            <div class="value">${replantios}</div>
                        </div>
                        <div class="kpi-card" style="border-left-color: var(--verde-secundario)">
                            <h4>Espécies Cadastradas</h4>
                            <div class="value">${totalEsp}</div>
                        </div>
                    </div>

                    <div class="charts-grid">
                        <div class="card">
                            <h4 style="margin-bottom:15px;">Orquídeas por Gênero</h4>
                            <div class="chart-container">
                                <canvas id="chartGeneros"></canvas>
                            </div>
                        </div>
                        <div class="card">
                            <h4 style="margin-bottom:15px;">Top 5 Espécies</h4>
                            <div class="chart-container">
                                <canvas id="chartEspecies"></canvas>
                            </div>
                        </div>
                        <div class="card">
                            <h4 style="margin-bottom:15px;">Status de Replantio</h4>
                            <div class="chart-container">
                                <canvas id="chartStatus"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- NOVA ÁREA DE AGENDA (V27.0) -->
                    <div class="dash-grid" style="margin-top:20px;">
                        <div class="card">
                            <h4 style="margin-bottom:15px; color:var(--verde-principal);"><i class="fas fa-seedling"></i> Próximos Replantios</h4>
                            ${renderList(listReplantios, 'replantio')}
                        </div>
                        <div class="card">
                            <h4 style="margin-bottom:15px; color:#0f5132;"><i class="fas fa-flask"></i> Agenda de Adubação</h4>
                            ${renderList(listAdubos, 'adubo')}
                        </div>
                        <div class="card">
                            <h4 style="margin-bottom:15px; color:#842029;"><i class="fas fa-shield-virus"></i> Agenda de Defensivos</h4>
                            ${renderList(listDefensivos, 'defensivo')}
                        </div>
                    </div>
                `;

                setTimeout(() => {
                    if (typeof Chart !== 'undefined') {
                        const orquideas = DB.get('orquideas');
                        const generos = {}; orquideas.forEach(o => generos[o.genero || 'Outros'] = (generos[o.genero || 'Outros'] || 0) + 1);
                        new Chart(document.getElementById('chartGeneros'), { type: 'doughnut', data: { labels: Object.keys(generos), datasets: [{ data: Object.values(generos), backgroundColor: ['#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0'] }] }, options: { responsive: true, maintainAspectRatio: false } });
                        
                        let emDia = 0, atrasado = 0; const now = new Date();
                        orquideas.forEach(o => { if(o.prox_replantio) new Date(o.prox_replantio) < now ? atrasado++ : emDia++; });
                        new Chart(document.getElementById('chartStatus'), { type: 'pie', data: { labels: ['Em Dia', 'Atrasado'], datasets: [{ data: [emDia, atrasado], backgroundColor: ['#2D5016', '#d32f2f'] }] }, options: { responsive: true, maintainAspectRatio: false } });
                    }
                }, 100);
            },

            calcularProximaData: (dataInicio, frequencia) => {
                if (!dataInicio || !frequencia) return dataInicio;
                
                const data = new Date(dataInicio + 'T00:00:00');
                const hoje = new Date();
                hoje.setHours(0, 0, 0, 0);
                
                const frequenciaMap = {
                    'Diária': 1,
                    'Semanal': 7,
                    'Quinzenal': 15,
                    'Mensal': 30,
                    'Trimestral': 90,
                    'Semestral': 180
                };
                
                const dias = frequenciaMap[frequencia] || 0;
                
                while (data < hoje) {
                    data.setDate(data.getDate() + dias);
                }
                
                return data.toISOString().split('T')[0];
            },

            obterLembretesPendentes: () => {
                const lembretes = DB.get('lembretes') || [];
                const hoje = new Date().toISOString().split('T')[0];
                
                return lembretes.filter(l => 
                    l.ativo === 'Sim' && l.proxima_data && l.proxima_data <= hoje
                ).sort((a, b) => new Date(a.proxima_data) - new Date(b.proxima_data));
            },

            showLembretesAtivos: () => {
                document.getElementById('header-title').innerText = 'Lembretes Pendentes';
                const content = document.getElementById('app-content');
                
                const lembretesPendentes = App.obterLembretesPendentes();
                
                if (lembretesPendentes.length === 0) {
                    content.innerHTML = `
                        <div style="text-align: center; padding: 60px 20px; color: #999;">
                            <i class="fas fa-check-circle" style="font-size: 3rem; margin-bottom: 20px; color: #4CAF50;"></i>
                            <h3 style="color: var(--verde-principal);">Tudo em dia!</h3>
                            <p>Não há lembretes pendentes no momento.</p>
                        </div>
                    `;
                    return;
                }
                
                let html = `
                    <div style="margin-bottom: 20px;">
                        <h3 style="color: var(--verde-principal); margin-bottom: 15px;">
                            <i class="fas fa-exclamation-circle"></i> ${lembretesPendentes.length} Lembrete(s) Pendente(s)
                        </h3>
                    </div>
                    <div class="table-container">
                        <table>
                            <thead><tr>
                                <th>Orquídea</th>
                                <th>Tipo</th>
                                <th>Frequência</th>
                                <th>Próxima Data</th>
                                <th>Dias Atrasado</th>
                                <th>Ação</th>
                            </tr></thead>
                            <tbody>
                `;
                
                lembretesPendentes.forEach(lembrete => {
                    const orquideas = DB.get('orquideas');
                    const orquidea = orquideas.find(o => o.codigo == lembrete.orquideaId);
                    const diasAtraso = Math.floor((new Date() - new Date(lembrete.proxima_data + 'T00:00:00')) / (1000 * 60 * 60 * 24));
                    
                    html += `
                        <tr>
                            <td><strong>${orquidea ? orquidea.codigo : 'N/A'}</strong></td>
                            <td>${lembrete.tipo}</td>
                            <td>${lembrete.frequencia}</td>
                            <td style="color: #e74c3c; font-weight: bold;">${lembrete.proxima_data}</td>
                            <td style="color: #e74c3c; font-weight: bold;">${diasAtraso} dia(s)</td>
                            <td>
                                <button class="btn btn-primary" onclick="App.marcarLembreteExecutado(${UI.getRealIndex(lembrete)})">
                                    <i class="fas fa-check"></i> Executado
                                </button>
                            </td>
                        </tr>
                    `;
                });
                
                html += `
                            </tbody>
                        </table>
                    </div>
                `;
                
                content.innerHTML = html;
            },

            marcarLembreteExecutado: (index) => {
                const lembretes = DB.get('lembretes');
                const lembrete = lembretes[index];
                if (!lembrete) return;
                
                const hoje = new Date().toISOString().split('T')[0];
                lembrete.ultima_execucao = hoje;
                lembrete.proxima_data = App.calcularProximaData(lembrete.proxima_data, lembrete.frequencia);
                
                const execucao = {
                    codigo: 'EXEC' + Date.now(),
                    lembreteId: lembrete.codigo,
                    orquideaId: lembrete.orquideaId,
                    tipo: lembrete.tipo,
                    data_execucao: hoje,
                    status: 'Concluído',
                    notas: ''
                };
                
                let execucoes = DB.get('execucoes_lembretes') || [];
                execucoes.push(execucao);
                
                DB.save('lembretes', lembretes);
                DB.save('execucoes_lembretes', execucoes);
                
                UI.showToast('✓ Lembrete marcado como concluído!');
                App.showLembretesAtivos();
            },

            // --- MÓDULO FINANCEIRO ---
            loadFinancial: () => {
                document.getElementById('header-title').innerText = 'Gestão Financeira';
                
                const orquideas = DB.get('orquideas');
                const vasos = DB.get('vasos');
                const substratos = DB.get('substratos');
                const adubos = DB.get('adubos');
                const defensivos = DB.get('defensivos');

                let totalInvestido = 0;
                let totalEstimado = 0;
                
                orquideas.forEach(o => {
                    totalInvestido += App.parseMoney(o.preco);
                    totalEstimado += App.parseMoney(o.valor_estimado) || App.parseMoney(o.preco);
                });

                let custoEstoque = 0;
                [vasos, substratos, adubos, defensivos].forEach(lista => {
                    lista.forEach(item => custoEstoque += App.parseMoney(item.preco));
                });

                const lucroPotencial = totalEstimado - totalInvestido;

                document.getElementById('app-content').innerHTML = `
                    <div class="dash-grid">
                        <div class="kpi-card kpi-money">
                            <h4>Total Investido (Plantas)</h4>
                            <div class="value">${App.formatMoney(totalInvestido)}</div>
                        </div>
                        <div class="kpi-card kpi-money">
                            <h4>Valor Estimado Atual</h4>
                            <div class="value">${App.formatMoney(totalEstimado)}</div>
                        </div>
                        <div class="kpi-card kpi-money" style="border-left-color: #e74c3c;">
                            <h4>Custo de Estoque (Insumos)</h4>
                            <div class="value">${App.formatMoney(custoEstoque)}</div>
                        </div>
                        <div class="kpi-card kpi-money" style="border-left-color: #f1c40f;">
                            <h4>Valorização Potencial</h4>
                            <div class="value">${App.formatMoney(lucroPotencial)}</div>
                        </div>
                    </div>

                    <div class="charts-grid">
                        <div class="card">
                            <h4 style="margin-bottom:15px;">Investimento vs. Valorização</h4>
                            <div class="chart-container">
                                <canvas id="chartInvest"></canvas>
                            </div>
                        </div>
                        <div class="card">
                            <h4 style="margin-bottom:15px;">Distribuição de Custos</h4>
                            <div class="chart-container">
                                <canvas id="chartCosts"></canvas>
                            </div>
                        </div>
                    </div>
                `;

                setTimeout(() => {
                    UI.activeCharts.forEach(c => c.destroy());
                    UI.activeCharts = [];

                    const ctx1 = document.getElementById('chartInvest');
                    if(ctx1) {
                        UI.activeCharts.push(new Chart(ctx1, {
                            type: 'bar',
                            data: {
                                labels: ['Total Investido', 'Valor Atual'],
                                datasets: [{
                                    label: 'Valores (R$)',
                                    data: [totalInvestido, totalEstimado],
                                    backgroundColor: ['#e74c3c', '#2ecc71']
                                }]
                            },
                            options: { responsive: true, maintainAspectRatio: false }
                        }));
                    }

                    const ctx2 = document.getElementById('chartCosts');
                    if(ctx2) {
                        UI.activeCharts.push(new Chart(ctx2, {
                            type: 'doughnut',
                            data: {
                                labels: ['Plantas', 'Estoque/Insumos'],
                                datasets: [{
                                    data: [totalInvestido, custoEstoque],
                                    backgroundColor: ['#2D5016', '#95a5a6']
                                }]
                            },
                            options: { responsive: true, maintainAspectRatio: false }
                        }));
                    }
                }, 100);
            },

            loadTable: (key) => {
                UI.renderTable(key);
            },

            edit: (table, index) => {
                UI.openModal(table, index);
            },

            save: (keepOpen) => {
                const table = UI.currentTable;
                const schema = SCHEMAS[table];
                const record = {};
                
                schema.fields.forEach(f => {
                    const el = document.getElementById(`field-${f.key}`);
                    if (el) record[f.key] = el.value;
                });

                let dateToSchedule = null;
                let eventTitle = "";

                if (table === 'orquideas' && record.prox_replantio) {
                    dateToSchedule = record.prox_replantio;
                    eventTitle = `SAS Florescendo suas Orquídeas - Replantio #${record.codigo}`;
                }
                else if (table === 'replantios' && record.prox_data) {
                    dateToSchedule = record.prox_data;
                    eventTitle = `SAS Florescendo suas Orquídeas - Próximo Replantio (Ref. #${record.orquidea})`;
                }
                else if (table === 'agendamentos' && record.data) {
                    dateToSchedule = record.data;
                    eventTitle = `SAS Florescendo suas Orquídeas - ${record.tipo}: ${record.detalhes}`;
                }

                if (table === 'replantios' && record.orquidea && record.data) {
                    const dataReplantio = new Date(record.data);
                    const proxData = new Date(dataReplantio);
                    proxData.setFullYear(proxData.getFullYear() + 2);
                    const proxDataStr = proxData.toISOString().split('T')[0];
                    record.prox_data = proxDataStr;

                    dateToSchedule = proxDataStr;
                    eventTitle = `SAS Florescendo suas Orquídeas - Próximo Replantio (Ref. #${record.orquidea})`;

                    const allOrquideas = DB.get('orquideas');
                    const match = record.orquidea.match(/^#(\d+)/);
                    const codigoOrq = match ? match[1] : null;
                    const orqIndex = allOrquideas.findIndex(o => o.codigo == codigoOrq);

                    if (orqIndex >= 0) {
                        allOrquideas[orqIndex].data_replantio = record.data;
                        allOrquideas[orqIndex].prox_replantio = proxDataStr;
                        localStorage.setItem('sas_orquideas', JSON.stringify(allOrquideas));
                        UI.showToast('Orquídea atualizada automaticamente!');
                    }
                }

                if (UI.editingIndex !== null) {
                    DB.update(table, UI.editingIndex, record);
                } else {
                    DB.add(table, record);
                }

                UI.showToast('Registro salvo!');
                
                const allData = DB.get(table);
                const searchInput = document.querySelector('input[placeholder="Pesquisar..."]');
                const term = searchInput ? searchInput.value.toLowerCase() : '';

                if (term) {
                    UI.filteredData = allData.filter(item => 
                        Object.values(item).some(val => String(val).toLowerCase().includes(term))
                    );
                } else {
                    UI.filteredData = allData;
                }

                if (UI.editingIndex === null) {
                    UI.currentIndex = UI.filteredData.length - 1;
                }

                UI.renderTable(table);

                if (dateToSchedule) {
                    if(confirm(`Deseja agendar "${eventTitle}" no Google Agenda para ${App.formatDate(dateToSchedule)}?`)) {
                        const d = dateToSchedule.replace(/-/g, '');
                        const dates = `${d}T090000Z/${d}T100000Z`; 
                        const text = encodeURIComponent(eventTitle);
                        const url = `https://calendar.google.com/calendar/render?action=TEMPLATE&text=${text}&dates=${dates}&add=${CONFIG.email}`;
                        window.open(url, '_blank');
                    }
                }
                
                if (keepOpen) {
                    UI.resetModal();
                } else {
                    UI.closeModal();
                }
            },

            delete: (table, index) => {
                if(confirm('Deseja realmente excluir este registro?')) {
                    DB.delete(table, index);
                    UI.renderTable(table);
                    UI.showToast('Registro excluído.');
                }
            },

            viewImage: (src) => {
                const w = window.open("");
                w.document.write(`<img src="${src}" style="max-width:100%">`);
            },

            exportCSV: (table) => {
                const data = DB.get(table);
                const schema = SCHEMAS[table];
                
                if (data.length === 0) {
                    alert("Não há dados para exportar.");
                    return;
                }

                let csvContent = "\uFEFF";
                csvContent += schema.fields.map(f => f.label).join(";") + "\n";

                data.forEach(row => {
                    let rowStr = schema.fields.map(f => {
                        let val = row[f.key] || "";
                        if (f.type === 'date' && val.length === 10) {
                            val = App.formatDate(val);
                        }
                        if (f.type === 'image' && val.length > 100) {
                            return "[Imagem Anexada]";
                        }
                        val = val.toString().replace(/"/g, '""');
                        if (val.search(/("|,|;|\n)/g) >= 0) {
                            val = `"${val}"`;
                        }
                        return val;
                    }).join(";");
                    csvContent += rowStr + "\n";
                });

                const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement("a");
                const url = URL.createObjectURL(blob);
                link.setAttribute("href", url);
                link.setAttribute("download", `sas_${table}_${new Date().toISOString().slice(0,10)}.csv`);
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            },

            generateQR: (id, title) => {
                const modal = document.getElementById('modal-qr-code');
                const container = document.getElementById('qrcode');
                container.innerHTML = '';
                document.getElementById('qr-title').innerText = `Orquídea #${id}`;
                document.getElementById('qr-subtitle').innerText = title || 'SAS Orquídeas';
                
                const baseUrl = window.location.href.split('?')[0];
                const targetUrl = `${baseUrl}?action=view&table=orquideas&id=${id}`;
                
                new QRCode(container, {
                    text: targetUrl,
                    width: 128,
                    height: 128,
                    colorDark : "#000000",
                    colorLight : "#ffffff",
                    correctLevel : QRCode.CorrectLevel.H
                });
                
                modal.style.display = 'flex';
            },

            loadBackupScreen: () => {
                document.getElementById('header-title').innerText = 'Segurança & Backup';
                document.getElementById('app-content').innerHTML = `
                    <div class="card">
                        <h3><i class="fas fa-shield-alt"></i> Gerenciamento de Dados</h3>
                        <p>Faça backup regular dos seus dados para garantir que nenhuma informação seja perdida.</p>
                        
                        <div style="margin-top:30px; display:grid; gap:20px; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));">
                            <div style="border:1px solid #eee; padding:20px; border-radius:8px;">
                                <h4><i class="fas fa-download"></i> Fazer Backup</h4>
                                <p style="font-size:0.9rem; color:#666;">Baixa um arquivo com todos os seus cadastros.</p>
                                <button class="btn btn-primary" onclick="App.downloadBackup()">Baixar Dados</button>
                            </div>
                            
                            <div style="border:1px solid #eee; padding:20px; border-radius:8px;">
                                <h4><i class="fas fa-upload"></i> Restaurar Dados</h4>
                                <p style="font-size:0.9rem; color:#666;">Recupera dados de um arquivo de backup.</p>
                                <button class="btn btn-secondary" onclick="App.triggerRestore()">Selecionar Arquivo</button>
                                <input type="file" id="restore-input" hidden accept=".json" onchange="App.handleRestore(this)">
                            </div>
                        </div>
                    </div>
                `;
            },

            downloadBackup: () => {
                const allData = {};
                Object.keys(localStorage).forEach(key => {
                    if(key.startsWith('sas_')) {
                        allData[key] = JSON.parse(localStorage.getItem(key));
                    }
                });
                
                const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(allData));
                const downloadAnchorNode = document.createElement('a');
                downloadAnchorNode.setAttribute("href", dataStr);
                downloadAnchorNode.setAttribute("download", "backup_sas_" + new Date().toISOString().slice(0,10) + ".json");
                document.body.appendChild(downloadAnchorNode);
                downloadAnchorNode.click();
                downloadAnchorNode.remove();
            },

            triggerRestore: () => document.getElementById('restore-input').click(),

            handleRestore: (input) => {
                const file = input.files[0];
                if(!file) return;

                if(!confirm("ATENÇÃO: Isso irá substituir TODOS os dados atuais pelos do backup. Deseja continuar?")) return;

                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const data = JSON.parse(e.target.result);
                        Object.keys(data).forEach(key => {
                            if(key.startsWith('sas_')) {
                                localStorage.setItem(key, JSON.stringify(data[key]));
                            }
                        });
                        alert("Dados restaurados com sucesso!");
                        location.reload();
                    } catch(err) {
                        alert("Erro ao ler arquivo de backup.");
                    }
                };
                reader.readAsText(file);
            },

            loadReports: () => {
                document.getElementById('header-title').innerText = 'Central de Relatórios';
                const content = document.getElementById('app-content');
                
                content.innerHTML = `
                    <div class="card toolbar">
                        <h3><i class="fas fa-print"></i> Central de Impressão</h3>
                        <p>Selecione um relatório abaixo. Para imprimir, pressione <b>Ctrl + P</b> após gerar o relatório.</p>
                    </div>
                    
                    <!-- BOTÃO DE RELATÓRIO GERAL (V79.0) -->
                    <div class="card" style="margin-bottom:20px; border-left:5px solid var(--destaque);">
                        <button class="btn btn-primary" style="width:100%; padding:15px; font-size:1.1rem;" onclick="App.runReportAll()">
                            <i class="fas fa-file-alt"></i> 📄 Relatório Geral (Todas as Tabelas)
                        </button>
                    </div>

                    <div class="report-grid">
                        <!-- 12.1 Orquídeas -->
                        <div class="card report-group">
                            <h4>Orquídeas</h4>
                            <div class="report-btn-list">
                                <button class="btn btn-ghost" onclick="App.runReport('orquideas', 'full')">12.1.1 Completo (Com Fotos)</button>
                                <button class="btn btn-ghost" onclick="App.runReport('orquideas', 'group', 'genero')">12.1.2 Por Gênero</button>
                                <button class="btn btn-ghost" onclick="App.runReport('orquideas', 'group', 'especie')">12.1.3 Por Espécie</button>
                                <button class="btn btn-ghost" onclick="App.runReport('orquideas', 'group', 'origem')">12.1.4 Por Origem</button>
                            </div>
                        </div>

                        <!-- 12.2 a 12.6 Estrutura -->
                        <div class="card report-group">
                            <h4>Estrutura & Insumos</h4>
                            <div class="report-btn-list">
                                <button class="btn btn-ghost" onclick="App.runReport('ambientes', 'full')">12.2 Ambientes</button>
                                <button class="btn btn-ghost" onclick="App.runReport('vasos', 'full')">12.3.1 Vasos (Completo)</button>
                                <button class="btn btn-ghost" onclick="App.runReport('vasos', 'group', 'tipo')">12.3.2 Vasos (Por Tipo)</button>
                                <button class="btn btn-ghost" onclick="App.runReport('substratos', 'full')">12.4/5 Substratos/Drenagem</button>
                                <button class="btn btn-ghost" onclick="App.runReport('adubos', 'full')">12.6 Adubos</button>
                                <button class="btn btn-ghost" onclick="App.runReport('defensivos', 'full')">12.8 Defensivos</button>
                            </div>
                        </div>

                        <!-- 12.7 Nutrição -->
                        <div class="card report-group">
                            <h4>Nutrição</h4>
                            <div class="report-btn-list">
                                <button class="btn btn-ghost" onclick="App.runReport('nutricao', 'full')">12.7.1 Completo</button>
                                <button class="btn btn-ghost" onclick="App.runReport('nutricao', 'date', 'custom')">12.7.2 Por Intervalo</button>
                                <button class="btn btn-ghost" onclick="App.runReport('nutricao', 'date', 30)">12.7.3 Últimos 30 dias</button>
                                <button class="btn btn-ghost" onclick="App.runReport('nutricao', 'date', 180)">12.7.4 Últimos 180 dias</button>
                            </div>
                        </div>

                        <!-- 12.9 a 12.11 Fitossanitário -->
                        <div class="card report-group">
                            <h4>Fitossanitário</h4>
                            <div class="report-btn-list">
                                <button class="btn btn-ghost" onclick="App.runReport('pragas', 'full')">12.9.1 Pragas (Completo)</button>
                                <button class="btn btn-ghost" onclick="App.runReport('pragas', 'group', 'nome')">12.9.2 Pragas (Por Nome)</button>
                                <button class="btn btn-ghost" onclick="App.runReport('doencas', 'full')">12.10.1 Doenças (Completo)</button>
                                <button class="btn btn-ghost" onclick="App.runReport('doencas', 'group', 'nome')">12.10.2 Doenças (Por Nome)</button>
                                <button class="btn btn-ghost" onclick="App.runReport('disturbios', 'full')">12.11.1 Distúrbios (Completo)</button>
                                <button class="btn btn-ghost" onclick="App.runReport('disturbios', 'group', 'tipo')">12.11.2 Distúrbios (Por Tipo)</button>
                                <button class="btn btn-ghost" onclick="App.runReport('disturbios', 'group', 'nutriente')">12.11.3 Distúrbios (Por Nutriente)</button>
                            </div>
                        </div>

                        <!-- 12.12 Replantios -->
                        <div class="card report-group">
                            <h4>Replantios</h4>
                            <div class="report-btn-list">
                                <button class="btn btn-ghost" onclick="App.runReport('replantios', 'full')">12.12.1 Completo</button>
                                <button class="btn btn-ghost" onclick="App.runReport('replantios', 'date', 'custom')">12.12.2 Por Intervalo</button>
                                <button class="btn btn-ghost" onclick="App.runReport('replantios', 'date', 30)">12.12.3 Últimos 30 dias</button>
                                <button class="btn btn-ghost" onclick="App.runReport('replantios', 'date', 180)">12.12.4 Últimos 180 dias</button>
                            </div>
                        </div>
                    </div>
                    <div id="report-result" style="margin-top:30px;"></div>
                `;
            },

            // --- FUNÇÃO DE RELATÓRIO GERAL (V79.0) ---
            runReportAll: () => {
                let fullHtml = `<div style="padding:20px;"><h1>Relatório Geral do Sistema</h1><p>Gerado em: ${new Date().toLocaleDateString()}</p><hr>`;
                
                // Itera sobre TODOS os schemas definidos
                Object.keys(SCHEMAS).forEach(tableKey => {
                    const schema = SCHEMAS[tableKey];
                    const data = DB.get(tableKey);
                    
                    fullHtml += `<h2 style="margin-top:30px; color:var(--verde-principal); border-bottom:2px solid #eee;">${schema.label}</h2>`;
                    
                    if (data.length === 0) {
                        fullHtml += `<p>Nenhum registro encontrado.</p>`;
                    } else {
                        // Usa layout de tabela simples para o relatório geral para economizar espaço
                        fullHtml += `<table style="width:100%; border-collapse:collapse; margin-top:10px;"><thead><tr>`;
                        
                        // Cabeçalho
                        schema.fields.forEach(f => {
                            if(f.type !== 'image') fullHtml += `<th style="border:1px solid #ccc; padding:8px; background:#f0f0f0;">${f.label}</th>`;
                        });
                        fullHtml += `</tr></thead><tbody>`;

                        // Linhas
                        data.forEach(row => {
                            fullHtml += `<tr>`;
                            schema.fields.forEach(f => {
                                if(f.type !== 'image') {
                                    let val = row[f.key] || '-';
                                    if (f.type === 'date' && val !== '-') val = App.formatDate(val);
                                    if (f.type === 'money') val = App.formatMoney(App.parseMoney(val));
                                    fullHtml += `<td style="border:1px solid #ccc; padding:8px;">${val}</td>`;
                                }
                            });
                            fullHtml += `</tr>`;
                        });
                        fullHtml += `</tbody></table>`;
                    }
                });

                fullHtml += `</div>`;
                
                const resultDiv = document.getElementById('report-result');
                resultDiv.innerHTML = fullHtml;
                resultDiv.scrollIntoView({ behavior: 'smooth' });
            },

            runReport: (table, type, param) => {
                const data = DB.get(table);
                const schema = SCHEMAS[table];
                let filteredData = [...data];
                let title = `Relatório: ${schema.label}`;

                if (type === 'date') {
                    let startDate, endDate;
                    const today = new Date();
                    
                    if (param === 'custom') {
                        const startStr = prompt("Data Inicial (AAAA-MM-DD):");
                        const endStr = prompt("Data Final (AAAA-MM-DD):");
                        if(!startStr || !endStr) return;
                        startDate = new Date(startStr);
                        endDate = new Date(endStr);
                        title += ` (De ${startStr} até ${endStr})`;
                    } else {
                        startDate = new Date();
                        startDate.setDate(today.getDate() - param);
                        endDate = today;
                        title += ` (Últimos ${param} dias)`;
                    }

                    filteredData = data.filter(row => {
                        const rowDate = new Date(row.data || row.data_replantio); 
                        return rowDate >= startDate && rowDate <= endDate;
                    });
                }

                if (type === 'group') {
                    filteredData.sort((a, b) => (a[param] || '').localeCompare(b[param] || ''));
                    title += ` (Agrupado por ${param})`;
                }

                // --- LÓGICA DE LAYOUT INTELIGENTE (V50.0) ---
                // Se tiver mais de 6 campos, usa layout de ficha (vertical)
                // Se tiver até 6 campos, usa layout de tabela (horizontal)
                const fieldCount = schema.fields.length;
                const useCardLayout = fieldCount > 6;

                let html = `<div class="card"><h3>${title}</h3>`;

                if (filteredData.length === 0) {
                    html += `<p style="text-align:center; padding:20px;">Nenhum registro encontrado.</p></div>`;
                    document.getElementById('report-result').innerHTML = html;
                    return;
                }

                if (useCardLayout) {
                    // LAYOUT FICHA (VERTICAL)
                    html += `<div class="report-cards-container">`;
                    
                    let lastGroup = null;
                    
                    filteredData.forEach(row => {
                        if (type === 'group') {
                            const currentGroup = row[param] || 'Não Informado';
                            if (currentGroup !== lastGroup) {
                                html += `<h4 style="background:#eee; padding:10px; margin:20px 0 10px 0; border-left:5px solid var(--verde-principal);">${currentGroup}</h4>`;
                                lastGroup = currentGroup;
                            }
                        }

                        html += `<div class="report-card">`;
                        
                        // Campos de Texto
                        schema.fields.forEach(f => {
                            if(f.type !== 'image') {
                                let val = row[f.key] || '-';
                                if (f.type === 'date' && val !== '-') val = App.formatDate(val);
                                if (f.type === 'money') val = App.formatMoney(App.parseMoney(val));
                                
                                html += `
                                    <div class="report-card-row">
                                        <div class="report-card-label">${f.label}</div>
                                        <div class="report-card-value">${val}</div>
                                    </div>
                                `;
                            }
                        });

                        // Imagens (se houver)
                        const imageFields = schema.fields.filter(f => f.type === 'image');
                        imageFields.forEach(f => {
                            const imgData = row[f.key];
                            if (imgData && imgData.length > 50) {
                                html += `
                                    <div class="report-card-image">
                                        <img src="${imgData}">
                                    </div>
                                `;
                            }
                        });

                        html += `</div>`; // Fecha report-card
                    });
                    html += `</div>`; // Fecha container

                } else {
                    // LAYOUT TABELA (HORIZONTAL - Padrão Antigo)
                    html += `<div class="table-container"><table><thead><tr>`;
                    schema.fields.forEach(f => {
                        if(f.type !== 'image') html += `<th>${f.label}</th>`;
                    });
                    html += `</tr></thead><tbody>`;

                    let lastGroup = null;
                    filteredData.forEach(row => {
                        if (type === 'group') {
                            const currentGroup = row[param] || 'Não Informado';
                            if (currentGroup !== lastGroup) {
                                html += `<tr style="background:#e0e0e0; font-weight:bold;"><td colspan="10">${currentGroup}</td></tr>`;
                                lastGroup = currentGroup;
                            }
                        }

                        html += `<tr>`;
                        schema.fields.forEach(f => {
                            if(f.type !== 'image') {
                                let val = row[f.key] || '-';
                                if (f.type === 'date' && val !== '-') val = App.formatDate(val);
                                if (f.type === 'money') val = App.formatMoney(App.parseMoney(val));
                                html += `<td>${val}</td>`;
                            }
                        });
                        html += `</tr>`;
                    });
                    html += `</tbody></table></div>`;
                }

                html += `</div>`; // Fecha card principal
                
                const resultDiv = document.getElementById('report-result');
                resultDiv.innerHTML = html;
                resultDiv.scrollIntoView({ behavior: 'smooth' });
            }
        };

        // --- SISTEMA DE AUTENTICAÇÃO (MOVIDO PARA O TOPO) ---
        const Auth = {
            init: () => {
                try {
                    const savedKey = localStorage.getItem('sas_license_key');
                    if (savedKey) {
                        document.getElementById('license-key').value = savedKey;
                        Auth.validate(true); // Valida silenciosamente
                    }
                } catch (e) {
                    console.log("Erro ao acessar localStorage (init):", e);
                }
            },

            // FUNÇÃO DE LIMPEZA (NORMALIZAÇÃO)
            cleanKey: (str) => {
                if (!str) return "";
                // Remove tudo que NÃO for letra ou número (pontos, traços, espaços, aspas)
                return str.replace(/[^a-zA-Z0-9]/g, '').toLowerCase();
            },

            validate: async (silent = false) => {
                const keyInput = document.getElementById('license-key');
                const btn = document.querySelector('.btn-login');
                const spinner = document.querySelector('.loading-spinner');
                const errorMsg = document.getElementById('login-error');
                const key = keyInput.value.trim();

                if (!key) return;

                if (!silent) {
                    btn.disabled = true;
                    btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Entrando...'; // Feedback Visual
                    errorMsg.style.display = 'none';
                }

                // Chave digitada limpa
                const inputClean = Auth.cleanKey(key);

                // --- FALLBACK DE SEGURANÇA (LOGIN OFFLINE) ---
                // Se a chave for a padrão de demonstração, libera o acesso sem internet
                if (inputClean === '00000') {
                    setTimeout(() => {
                        Auth.success('Usuário Local', key);
                    }, 500);
                    return;
                }

                try {
                    // Busca dados da planilha via Proxy
                    const response = await fetch(URL_PLANILHA);
                    if (!response.ok) throw new Error('Erro na conexão com a planilha');
                    
                    const text = await response.text();
                    
                    // Parser CSV Robusto
                    const rows = text.split(/\r?\n/); 

                    let isValid = false;
                    let userName = 'Usuário';

                    // Percorre as linhas
                    for (let i = 0; i < rows.length; i++) {
                        const row = rows[i];
                        if(!row) continue;

                        // Divide por vírgula
                        const cols = row.split(',');
                        
                        // Limpa os dados da planilha antes de comparar
                        const rowKeyClean = Auth.cleanKey(cols[0]);
                        const rowStatus = cols[1] ? cols[1].replace(/"/g, '').trim().toLowerCase() : '';
                        const rowName = cols[2] ? cols[2].replace(/"/g, '').trim() : 'Usuário';

                        // COMPARAÇÃO INTELIGENTE (LIMPA vs LIMPA)
                        if (rowKeyClean === inputClean && rowStatus === 'ativo') {
                            isValid = true;
                            userName = rowName;
                            break;
                        }
                    }

                    if (isValid) {
                        Auth.success(userName, key);
                    } else {
                        throw new Error('Chave inválida');
                    }

                } catch (err) {
                    if (!silent) {
                        // Se falhar a conexão, tenta o fallback local se a senha for a padrão
                        if (inputClean === '------') {
                             Auth.success('Usuário Local (Offline)', key);
                             return;
                        }

                        errorMsg.style.display = 'block';
                        errorMsg.innerText = 'Acesso Negado: ' + err.message;
                        console.error("Erro Login:", err);
                        btn.disabled = false;
                        btn.innerHTML = '<i class="fas fa-lock"></i> ACESSAR SISTEMA';
                        localStorage.removeItem('sas_license_key');
                    }
                }
            },

            success: (name, key) => {
                try {
                    if(key) localStorage.setItem('sas_license_key', key);
                } catch (e) {
                    console.log("Erro ao salvar chave:", e);
                }
                
                document.getElementById('user-name-display').innerText = name;
                
                // Animação de saída do login
                const loginScreen = document.getElementById('login-screen');
                loginScreen.style.opacity = '0';
                setTimeout(() => {
                    loginScreen.style.display = 'none';
                    document.getElementById('app-wrapper').style.display = 'flex'; // Mostra o App
                    
                    // Tenta iniciar o App com tratamento de erro
                    try {
                        App.init(); 
                    } catch (e) {
                        alert("Erro ao carregar dados: " + e.message);
                        console.error(e);
                    }
                }, 500);
            },

            logout: () => {
                localStorage.removeItem('sas_license_key');
                location.reload();
            }
        };

        // --- INICIALIZAÇÃO SEGURA ---
        window.onload = function() {
            try {
                Auth.init();
            } catch (e) {
                console.error("Erro Fatal na Inicialização:", e);
                // Se falhar, tenta mostrar o login de qualquer jeito
                document.getElementById('login-screen').style.display = 'flex';
            }
        };
    </script>
</body>
</html>
